<template>
  <div class="code-examples">
    <!-- åŸºç¡€ç”¨æ³• -->
    <h3>1ï¸âƒ£ åŸºç¡€ç”¨æ³•</h3>
    <p>æœ€ç®€å•çš„æ¥å…¥æ–¹å¼ï¼š</p>
    <CodeBlock :code="basicUsageCode" />

    <!-- å®Œæ•´é…ç½® -->
    <h3>2ï¸âƒ£ å®Œæ•´é…ç½®ç¤ºä¾‹</h3>
    <p>æ‰€æœ‰å¯ç”¨çš„é…ç½®å‚æ•°ï¼š</p>
    <CodeBlock :code="fullConfigCode" />

    <!-- äº‹ä»¶ç›‘å¬ -->
    <h3>3ï¸âƒ£ äº‹ä»¶ç›‘å¬</h3>
    <p>ç›‘å¬ SDK çš„å„ç§äº‹ä»¶ï¼š</p>
    <CodeBlock :code="eventListenersCode" />

    <!-- æ–¹æ³•è°ƒç”¨ -->
    <h3>4ï¸âƒ£ æ–¹æ³•è°ƒç”¨</h3>
    <p>SDK æä¾›çš„å¸¸ç”¨æ–¹æ³•ï¼š</p>
    <CodeBlock :code="methodsCode" />

    <!-- æµå¼è¾“å‡ºç¤ºä¾‹ -->
    <h3>5ï¸âƒ£ æµå¼è¾“å‡ºç¤ºä¾‹</h3>
    <p>æ¨¡æ‹Ÿ ChatGPT çš„æµå¼è¾“å‡ºæ•ˆæœï¼š</p>
    <CodeBlock :code="streamingCode" />

    <!-- æµ®åŠ¨æŒ‰é’®ç¤ºä¾‹ -->
    <h3>6ï¸âƒ£ è‡ªå®šä¹‰æµ®åŠ¨æŒ‰é’®</h3>
    <p>SDK ä¸æä¾›æµ®åŠ¨æŒ‰é’®ï¼Œéœ€è¦æ¥å…¥æ–¹è‡ªå·±å®ç°ï¼š</p>
    <CodeBlock :code="customButtonCode" />

    <!-- TypeScript æ”¯æŒ -->
    <h3>7ï¸âƒ£ TypeScript æ”¯æŒ</h3>
    <p>å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼š</p>
    <CodeBlock :code="typescriptCode" />

    <!-- å®é™…åº”ç”¨ç¤ºä¾‹ -->
    <h3>8ï¸âƒ£ å®Œæ•´çš„ AI é›†æˆç¤ºä¾‹</h3>
    <p>æ¥å…¥çœŸå®çš„ AI APIï¼š</p>
    <CodeBlock :code="aiIntegrationCode" />
  </div>
</template>

<script setup lang="ts">
import CodeBlock from './CodeBlock.vue'

const basicUsageCode = `import { createChatSDK } from 'ai-bot'

// åˆ›å»º SDK å®ä¾‹
const sdk = createChatSDK({
  title: 'æ™ºèƒ½å®¢æœ',
  welcomeMessage: 'Hiï¼Œæˆ‘æ˜¯æ™ºèƒ½å®¢æœ',
  quickQuestions: [
    { id: '1', text: 'å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¹³å°ï¼Ÿ' },
    { id: '2', text: 'è´¦å·å¦‚ä½•æ³¨å†Œï¼Ÿ' }
  ]
})

// æŒ‚è½½åˆ°é¡µé¢
sdk.mount()

// æ‰“å¼€èŠå¤©çª—å£
sdk.open()

// å…³é—­èŠå¤©çª—å£
sdk.close()`

const fullConfigCode = `import { createChatSDK } from 'ai-bot'

const sdk = createChatSDK({
  // åŸºç¡€é…ç½®
  title: 'æ™ºèƒ½å®¢æœ',
  placeholder: 'ä½ å¯ä»¥é—®æˆ‘ä»»ä½•é—®é¢˜',
  welcomeMessage: 'Hiï¼Œæˆ‘æ˜¯æ™ºèƒ½å®¢æœï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼',

  // å¸ƒå±€ä½ç½®ï¼š'left' | 'right'ï¼ˆé»˜è®¤ï¼‰
  position: 'right',

  // ä¸»é¢˜ï¼š'light' | 'dark'ï¼ˆé»˜è®¤ lightï¼‰
  theme: 'light',

  // å¿«æ·é—®é¢˜é…ç½®
  quickQuestions: [
    { id: '1', text: 'å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¹³å°ï¼Ÿ' },
    { id: '2', text: 'è´¦å·å¦‚ä½•æ³¨å†Œï¼Ÿ' },
    { id: '3', text: 'å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ' },
    { id: '4', text: 'å¦‚ä½•è”ç³»äººå·¥å®¢æœï¼Ÿ' }
  ],

  // å†å²è®°å½•é…ç½®
  enableHistory: true,        // å¯ç”¨å†å²è®°å½•
  maxHistoryDays: 7,          // ä¿ç•™æœ€è¿‘7å¤©çš„è®°å½•

  // å¤´åƒé…ç½®
  avatar: {
    assistant: 'https://example.com/ai-avatar.png',
    user: 'https://example.com/user-avatar.png'
  },

  // API é…ç½®ï¼ˆé¢„ç•™ï¼Œå¯ç”¨äºå†…ç½® API è°ƒç”¨ï¼‰
  apiBaseUrl: 'https://api.example.com',
  apiEndpoint: '/chat'
})

sdk.mount()`

const eventListenersCode = `// ç›‘å¬æ¶ˆæ¯å‘é€äº‹ä»¶
sdk.on('sendMessage', async (content) => {
  console.log('ç”¨æˆ·å‘é€æ¶ˆæ¯:', content)

  // è°ƒç”¨æ‚¨çš„ AI API
  const response = await fetchAIResponse(content)

  // æ·»åŠ  AI å›å¤
  sdk.addMessage({
    id: Date.now().toString(),
    role: 'assistant',
    content: response,
    timestamp: Date.now()
  })
})

// ç›‘å¬çª—å£æ‰“å¼€äº‹ä»¶
sdk.on('open', () => {
  console.log('èŠå¤©çª—å£å·²æ‰“å¼€')
})

// ç›‘å¬çª—å£å…³é—­äº‹ä»¶
sdk.on('close', () => {
  console.log('èŠå¤©çª—å£å·²å…³é—­')
})

// ç›‘å¬æ¶ˆæ¯æ·»åŠ äº‹ä»¶
sdk.on('message', (message) => {
  console.log('æ–°æ¶ˆæ¯:', message)
})

// ç›‘å¬æ¶ˆæ¯æ›´æ–°äº‹ä»¶ï¼ˆæµå¼è¾“å‡ºï¼‰
sdk.on('messageUpdate', (message) => {
  console.log('æ¶ˆæ¯æ›´æ–°:', message)
})

// ç›‘å¬æ¶ˆæ¯å®Œæˆäº‹ä»¶
sdk.on('messageComplete', (message) => {
  console.log('æ¶ˆæ¯å®Œæˆ:', message)
})

// ç›‘å¬ç‚¹èµç‚¹è¸©äº‹ä»¶
sdk.on('feedback', (message) => {
  console.log('ç”¨æˆ·åé¦ˆ:', message.feedback)
})

// ç›‘å¬æ¸…é™¤æ¶ˆæ¯äº‹ä»¶
sdk.on('clear', () => {
  console.log('æ¶ˆæ¯å·²æ¸…ç©º')
})

// å–æ¶ˆç›‘å¬
const handler = (content) => console.log(content)
sdk.on('sendMessage', handler)
sdk.off('sendMessage', handler)`

const methodsCode = `// çª—å£æ§åˆ¶
sdk.open()              // æ‰“å¼€èŠå¤©çª—å£
sdk.close()             // å…³é—­èŠå¤©çª—å£
sdk.toggle()            // åˆ‡æ¢èŠå¤©çª—å£çŠ¶æ€
console.log(sdk.isOpen.value)  // è·å–çª—å£å¼€å…³çŠ¶æ€

// æ¶ˆæ¯æ“ä½œ
sdk.sendMessage('ä½ å¥½')  // å‘é€æ¶ˆæ¯ï¼ˆä¼šè§¦å‘ sendMessage äº‹ä»¶ï¼‰

sdk.addMessage({        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
  id: 'msg-001',
  role: 'assistant',
  content: 'è¿™æ˜¯å›å¤å†…å®¹',
  timestamp: Date.now()
})

sdk.clearMessages()     // æ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯

// æµå¼è¾“å‡ºæ”¯æŒ
sdk.appendMessageContent('msg-001', 'è¿½åŠ å†…å®¹')
sdk.finishMessageStream('msg-001')

// é…ç½®æ›´æ–°
sdk.updateConfig({
  title: 'æ–°æ ‡é¢˜',
  position: 'left'
})

// å¸è½½ SDK
sdk.unmount()`

const streamingCode = `import { createChatSDK } from 'ai-bot'

const sdk = createChatSDK()

sdk.on('sendMessage', async (content) => {
  // åˆ›å»ºä¸€ä¸ª AI æ¶ˆæ¯
  const messageId = Date.now().toString()
  sdk.addMessage({
    id: messageId,
    role: 'assistant',
    content: '',
    isStreaming: true,
    timestamp: Date.now()
  })

  // æ¨¡æ‹Ÿæµå¼è¾“å‡º
  const response = await fetchAIResponseStream(content)

  // é€å­—è¿½åŠ å†…å®¹
  for await (const chunk of response) {
    sdk.appendMessageContent(messageId, chunk)
  }

  // å®Œæˆæµå¼è¾“å‡º
  sdk.finishMessageStream(messageId)
})`

const customButtonCode = `<template>
  <!-- æµ®åŠ¨æŒ‰é’® -->
  <button
    v-if="isShowBtn"
    class="floating-button"
    @click="toggleChat"
  >
    ğŸ’¬
  </button>
</template>

<script setup>
import { ref } from 'vue'
import { createChatSDK } from 'ai-bot'

const sdk = createChatSDK()
const isShowBtn = ref(true)

sdk.mount()

// ç›‘å¬çª—å£çŠ¶æ€ï¼Œæ§åˆ¶æŒ‰é’®æ˜¾éš
sdk.on('open', () => { isShowBtn.value = false })
sdk.on('close', () => { isShowBtn.value = true })

const toggleChat = () => {
  sdk.isOpen.value ? sdk.close() : sdk.open()
}
<\/script>

<style>
.floating-button {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  z-index: 1000000; /* å¿…é¡»é«˜äº SDK çš„ 999999 */
}
<\/style>`

const typescriptCode = `import { createChatSDK } from 'ai-bot'
import type { ChatSDK, ChatSDKConfig, ChatMessage, QuickQuestion } from 'ai-bot'

// ç±»å‹å®‰å…¨çš„é…ç½®
const config: ChatSDKConfig = {
  title: 'æ™ºèƒ½å®¢æœ',
  position: 'left',        // âœ… ç±»å‹å®‰å…¨
  // position: 'center',    // âŒ ç¼–è¯‘é”™è¯¯
}

const sdk: ChatSDK = createChatSDK(config)

// ç±»å‹æ£€æŸ¥
const message: ChatMessage = {
  id: 'msg-001',
  role: 'assistant',       // âœ… åªèƒ½æ˜¯ 'user' | 'assistant' | 'system'
  content: 'ä½ å¥½',
  timestamp: Date.now(),
  feedback: 'like'         // å¯é€‰çš„ç‚¹èµç‚¹è¸©
}

const question: QuickQuestion = {
  id: '1',
  text: 'å¦‚ä½•ä½¿ç”¨ï¼Ÿ'
}`

const aiIntegrationCode = `import { createChatSDK } from 'ai-bot'

const sdk = createChatSDK({
  title: 'AI åŠ©æ‰‹',
  enableHistory: true,
  maxHistoryDays: 30
})

sdk.mount()

// ç›‘å¬æ¶ˆæ¯å‘é€
sdk.on('sendMessage', async (content) => {
  try {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ˆSDK å†…éƒ¨å¤„ç†ï¼‰
    sdk.isLoading.value = true

    // è°ƒç”¨ AI API
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': \`Bearer \${API_KEY}\`
      },
      body: JSON.stringify({
        model: 'gpt-4',
        messages: [
          { role: 'user', content }
        ]
      })
    })

    const data = await response.json()

    // æ·»åŠ  AI å›å¤
    sdk.addMessage({
      id: Date.now().toString(),
      role: 'assistant',
      content: data.choices[0].message.content,
      timestamp: Date.now()
    })
  } catch (error) {
    // æ·»åŠ é”™è¯¯æç¤º
    sdk.addMessage({
      id: Date.now().toString(),
      role: 'system',
      content: 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚',
      timestamp: Date.now()
    })
  } finally {
    sdk.isLoading.value = false
  }
})`
</script>

<style scoped lang="less">
@import '../../styles/variables.less';

.code-examples {
  h3 {
    font-size: @font-size-xl;
    color: @text-primary;
    margin-top: @spacing-2xl;
    margin-bottom: @spacing-md;
    padding-bottom: @spacing-sm;
    border-bottom: 2px solid #f0f0f0;
  }

  p {
    font-size: @font-size-base;
    color: @text-secondary;
    line-height: 1.6;
    margin-bottom: @spacing-lg;
  }
}
</style>
