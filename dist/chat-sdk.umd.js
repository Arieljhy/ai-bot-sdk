(function(b,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(b=typeof globalThis<"u"?globalThis:b||self,e(b.ChatSDK={},b.Vue))})(this,(function(b,e){"use strict";const _={class:"cs-header"},L={class:"cs-header-left"},I={class:"cs-avatar"},T={key:0,viewBox:"0 0 24 24",fill:"currentColor"},H=["src"],O={class:"cs-title"},j={class:"cs-header-right"},A=e.defineComponent({__name:"ChatHeader",props:{title:{default:"智能客服"},avatar:{}},emits:["close","menu"],setup(n){return(s,t)=>(e.openBlock(),e.createElementBlock("div",_,[e.createElementVNode("div",L,[e.createElementVNode("div",I,[n.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:n.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,H)):(e.openBlock(),e.createElementBlock("svg",T,[...t[2]||(t[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))]),e.createElementVNode("span",O,e.toDisplayString(n.title),1)]),e.createElementVNode("div",j,[e.createElementVNode("button",{class:"cs-icon-btn",onClick:t[0]||(t[0]=a=>s.$emit("menu"))},[...t[3]||(t[3]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})],-1)])]),e.createElementVNode("button",{class:"cs-icon-btn cs-close-btn",onClick:t[1]||(t[1]=a=>s.$emit("close"))},[...t[4]||(t[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])])]))}}),x=(n,s)=>{const t=n.__vccOpts||n;for(const[a,o]of s)t[a]=o;return t},P=x(A,[["__scopeId","data-v-c3c54fb3"]]),F={class:"cs-welcome-section"},K={class:"cs-welcome-card"},U={class:"cs-welcome-header"},W={class:"cs-welcome-left"},G={class:"cs-welcome-text"},R={class:"cs-welcome-title"},J={key:0,class:"cs-welcome-subtitle"},Y={class:"cs-questions-list"},X=["onClick"],Z={class:"cs-question-text"},ee=x(e.defineComponent({__name:"WelcomeSection",props:{welcomeMessage:{default:"Hi，我是智能客服"},quickQuestions:{default:()=>[]},showWelcome:{type:Boolean,default:!0}},emits:["askQuestion","refreshQuestions"],setup(n,{emit:s}){const t=s,a=e.ref(!1),o=r=>{t("askQuestion",r)},l=()=>{a.value=!0,setTimeout(()=>{a.value=!1},500),t("refreshQuestions")};return(r,m)=>(e.openBlock(),e.createElementBlock("div",F,[e.createElementVNode("div",K,[e.createElementVNode("div",U,[e.createElementVNode("div",W,[m[0]||(m[0]=e.createElementVNode("div",{class:"cs-avatar"},[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),e.createElementVNode("div",G,[e.createElementVNode("div",R,e.toDisplayString(n.welcomeMessage),1),n.showWelcome?(e.openBlock(),e.createElementBlock("div",J,"你可以试着问我：")):e.createCommentVNode("",!0)])]),e.createElementVNode("button",{class:"cs-refresh-btn",onClick:l},[(e.openBlock(),e.createElementBlock("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:e.normalizeClass({"rotate-animating":a.value})},[...m[1]||(m[1]=[e.createElementVNode("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},null,-1)])],2)),m[2]||(m[2]=e.createElementVNode("span",null,"换一换",-1))])]),e.createElementVNode("div",Y,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.quickQuestions,i=>(e.openBlock(),e.createElementBlock("div",{key:i.id,class:"cs-question-item",onClick:h=>o(i)},[e.createElementVNode("div",Z,e.toDisplayString(i.text),1)],8,X))),128))])])]))}}),[["__scopeId","data-v-d56a62e7"]]),te={key:0,class:"cs-message-avatar"},se={class:"cs-avatar cs-avatar-assistant"},ae={key:0,viewBox:"0 0 24 24",fill:"currentColor"},ne=["src"],oe={class:"cs-message-wrapper"},ie={class:"cs-message-content"},re={key:0,class:"cs-streaming-indicator"},ce={key:0,class:"cs-feedback-actions"},le={key:1,class:"cs-message-avatar"},de=x(e.defineComponent({__name:"MessageItem",props:{message:{},avatar:{}},emits:["feedback"],setup(n,{emit:s}){const t=n,a=s,o=l=>{t.message.feedback===l?a("feedback",t.message.id,null):a("feedback",t.message.id,l)};return(l,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cs-message-item",`cs-message-${n.message.role}`])},[n.message.role==="assistant"?(e.openBlock(),e.createElementBlock("div",te,[e.createElementVNode("div",se,[n.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:n.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,ne)):(e.openBlock(),e.createElementBlock("svg",ae,[...r[2]||(r[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))])])):e.createCommentVNode("",!0),e.createElementVNode("div",oe,[e.createElementVNode("div",{class:e.normalizeClass(["cs-message-bubble",`cs-bubble-${n.message.role}`])},[e.createElementVNode("div",ie,e.toDisplayString(n.message.content),1),n.message.isStreaming?(e.openBlock(),e.createElementBlock("div",re,[...r[3]||(r[3]=[e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1)])])):e.createCommentVNode("",!0)],2),n.message.role==="assistant"&&!n.message.isStreaming?(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":n.message.feedback==="like"}]),onClick:r[0]||(r[0]=m=>o("like"))},[...r[4]||(r[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})],-1)])],2),e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":n.message.feedback==="dislike"}]),onClick:r[1]||(r[1]=m=>o("dislike"))},[...r[5]||(r[5]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"})],-1)])],2)])):e.createCommentVNode("",!0)]),n.message.role==="user"?(e.openBlock(),e.createElementBlock("div",le,[...r[6]||(r[6]=[e.createElementVNode("div",{class:"cs-avatar cs-avatar-user"},[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)])])):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-ee56945d"]]),fe={class:"cs-messages-list"},me=x(e.defineComponent({__name:"MessagesList",props:{messages:{},config:{},streamingMessageId:{default:void 0},streamingContent:{default:""}},emits:["feedback"],setup(n,{emit:s}){const t=n,a=s,o=e.ref("");e.watch(()=>t.streamingContent,i=>{i?o.value=i:o.value=""},{immediate:!0}),e.watch(()=>t.streamingMessageId,(i,h)=>{i!==h&&(o.value="")});const l=e.computed(()=>{const i=[...t.messages];if(t.streamingMessageId&&o.value){const h=i.findIndex(c=>c.id===t.streamingMessageId);if(h>=0){const c=i[h];i[h]={id:c.id,role:c.role,content:o.value,isStreaming:!0,timestamp:c.timestamp,feedback:c.feedback}}else i.push({id:t.streamingMessageId,role:"assistant",content:o.value,isStreaming:!0,timestamp:Date.now()})}return i}),r=i=>{if(i.role==="assistant")return t.config.avatar?.assistant;if(i.role==="user")return t.config.avatar?.user},m=(i,h)=>{a("feedback",i,h)};return(i,h)=>(e.openBlock(),e.createElementBlock("div",fe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,c=>(e.openBlock(),e.createBlock(de,{key:c.id,message:c,avatar:r(c),onFeedback:m},null,8,["message","avatar"]))),128))]))}}),[["__scopeId","data-v-531b4005"]]),he={class:"cs-input-container"},ge={class:"cs-input-wrapper"},pe=["placeholder","disabled"],ue=["disabled"],be=x(e.defineComponent({__name:"MessageInput",props:{placeholder:{default:"你可以问我任何平台相关的问题"},disabled:{type:Boolean,default:!1}},emits:["send"],setup(n,{expose:s,emit:t}){const a=t,o=e.ref(""),l=e.ref(),r=e.computed(()=>o.value.trim().length>0),m=()=>{},i=()=>{const c=o.value.trim();c&&(o.value="",a("send",c))};return s({focus:()=>{e.nextTick(()=>{l.value?.focus()})}}),(c,f)=>(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("div",ge,[e.withDirectives(e.createElementVNode("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":f[0]||(f[0]=d=>o.value=d),type:"text",class:"cs-input",placeholder:n.placeholder,disabled:n.disabled,onKeydown:e.withKeys(i,["enter"]),onInput:m},null,40,pe),[[e.vModelText,o.value]]),e.createElementVNode("button",{class:e.normalizeClass(["cs-send-btn",{"cs-send-btn-active":r.value}]),disabled:n.disabled||!r.value,onClick:i},[...f[1]||(f[1]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])],10,ue)])]))}}),[["__scopeId","data-v-582889fb"]]),xe={key:0,class:"cs-quick-questions"},ve={class:"cs-questions-scroll",ref:"scrollContainer"},ke=["onClick"],we={class:"cs-question-text"},ye=x(e.defineComponent({__name:"QuickQuestions",props:{quickQuestions:{default:()=>[]}},emits:["askQuestion"],setup(n){return(s,t)=>n.quickQuestions.length>0?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",ve,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.quickQuestions,a=>(e.openBlock(),e.createElementBlock("div",{key:a.id,class:"cs-question-chip",onClick:o=>s.$emit("askQuestion",a)},[e.createElementVNode("span",we,e.toDisplayString(a.text),1)],8,ke))),128))],512)])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-fc7fd5f8"]]),Ce=[{id:"1",text:"如何使用这个平台？"},{id:"2",text:"账号如何注册？"},{id:"3",text:"忘记密码怎么办？"},{id:"4",text:"如何联系人工客服？"},{id:"5",text:"平台支持哪些功能？"},{id:"6",text:"如何查看使用记录？"}];function Se(n=[]){const s=e.ref([]),t=e.ref([]),a=e.ref([]),o=e.ref(0),l=()=>{const i=n.length>0?n:Ce;t.value=i,a.value=r(i,2),s.value=a.value[0]||[],o.value=0},r=(i,h)=>{const c=[];for(let f=0;f<i.length;f+=h)c.push(i.slice(f,f+h));return c},m=()=>{a.value.length!==0&&(o.value=(o.value+1)%a.value.length,s.value=a.value[o.value]??[])};return l(),{displayedQuestions:s,allQuickQuestions:t,refreshQuestions:m}}function Ee(n={}){const s=e.ref(""),t=e.ref(!1),a=e.ref(null);let o=null,l=null,r=n;const m=d=>{if(typeof d=="object"&&d!==null){if("choices"in d&&d.choices?.[0]?.delta?.content)return d.choices[0].delta.content;if("delta"in d&&d.delta?.text)return d.delta.text;if("content"in d&&typeof d.content=="string")return d.content}return typeof d=="string"?d:""},i=(d,C)=>{if(!d.trim())return"";if(d.startsWith("data: ")){const u=d.slice(6).trim();if(u==="[DONE]")return"";try{const w=JSON.parse(u),v=m(w);return v&&(s.value+=v,C?.(v)),v}catch{return u?(s.value+=u,C?.(u),u):""}}return d.startsWith("event: "),""},h=async d=>{const C={...r,...d},{url:u="http://localhost:3000/sse",method:w="POST",headers:v={},body:E,onMessage:B,onComplete:N,onError:z}=C;t.value&&c(),a.value=null,t.value=!0,o=new AbortController;try{const p=await fetch(u,{method:w,headers:{"Content-Type":"application/json",Accept:"text/event-stream",...v},body:E?JSON.stringify(E):void 0,signal:o.signal});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);if(!p.body)throw new Error("无法获取 ReadableStream");l=p.body.getReader();const y=new TextDecoder;let g="";for(;;){const{done:k,value:S}=await l.read();if(k){if(g.trim()){const V=g.split(`
`);for(const qe of V)i(qe,B)}t.value=!1,N?.();break}const Qe=y.decode(S,{stream:!0});g+=Qe;const D=g.split(`
`);g=D.pop()||"";for(const V of D)V.trim()&&i(V,B)}}catch(p){if(p.name==="AbortError"){t.value=!1;return}const y=p instanceof Error?p:new Error(String(p));throw a.value=y,t.value=!1,z?.(y),y}finally{l=null,o=null}},c=()=>{o&&(o.abort(),o=null),l&&(l.cancel(),l=null),t.value=!1},f=()=>{c(),s.value="",a.value=null};return e.onUnmounted(()=>{c()}),{content:s,isLoading:t,error:a,start:h,stop:c,reset:f}}function Be(n){const s=e.ref(),t=e.ref(""),{content:a,start:o,reset:l}=Ee();let r=0;e.watch(a,c=>{if(c&&c.length>r){const f=c.slice(r);t.value+=f,r=c.length}});const m=async(c,f)=>{l(),r=0,t.value="",s.value=Date.now().toString();try{await o({url:f?.sseUrl||n.sseUrl||"http://localhost:3000/sse",method:f?.sseMethod||n.sseMethod||"POST",body:{message:c,history:[]},onComplete:()=>{console.log("✅ 流式传输完成"),s.value&&t.value&&f?.onComplete?.(s.value,t.value),i()},onError:d=>{console.error("❌ SSE 错误:",d),t.value+=`错误：${d.message}`,s.value&&t.value&&f?.onComplete?.(s.value,t.value),i()}})}catch(d){console.error("❌ 启动 SSE 失败:",d),t.value+="网络错误，请检查连接",s.value&&t.value&&f?.onComplete?.(s.value,t.value),i()}},i=()=>{s.value=void 0,t.value=""};return{streamingMessageId:s,streamingContent:t,startStreamingChat:m,isStreaming:()=>!!s.value}}function Ne(n,s){const t=e.ref(0);return{savedScrollTop:t,scrollToBottom:()=>{e.nextTick(()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)})},saveScrollPosition:()=>{n.value&&!s.value&&(t.value=n.value.scrollTop)},restoreScrollPosition:()=>{s.value||e.nextTick(()=>{n.value&&t.value>0&&(n.value.scrollTop=t.value)})},resetScrollPosition:()=>{t.value=0},watchStreamingContent:()=>{e.watch(s,()=>{e.nextTick(()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)})})}}}const Ve=x(e.defineComponent({__name:"ChatWindow",props:{isOpen:{type:Boolean},config:{},messages:{},isLoading:{type:Boolean,default:!1}},emits:["close","sendMessage","askQuestion","feedback","streamingComplete"],setup(n,{emit:s}){const t=n,a=s,o=e.computed(()=>t.config.position||"right"),l=e.computed(()=>o.value==="left"?"slide-left":"slide-right"),r=e.ref(),{displayedQuestions:m,allQuickQuestions:i,refreshQuestions:h}=Se(t.config.quickQuestions||[]),{streamingMessageId:c,streamingContent:f,startStreamingChat:d}=Be(t.config),{saveScrollPosition:C,restoreScrollPosition:u,resetScrollPosition:w,scrollToBottom:v,watchStreamingContent:E}=Ne(r,f);E(),e.watch(()=>t.messages,v,{deep:!0}),e.watch(()=>t.isOpen,g=>{g&&u()}),e.onMounted(()=>{});const B=()=>{h()},N=g=>{a("askQuestion",g),d(g.text,{onComplete:(k,S)=>{a("streamingComplete",k,S),w()}})},z=(g,k)=>{a("feedback",g,k)},p=g=>{a("sendMessage",g),d(g,{onComplete:(k,S)=>{a("streamingComplete",k,S),w()}})},y=()=>{C(),a("close")};return(g,k)=>(e.openBlock(),e.createBlock(e.Transition,{name:l.value},{default:e.withCtx(()=>[n.isOpen?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["cs-chat-window",`cs-chat-window-${o.value}`])},[e.createVNode(P,{title:n.config.title||"智能客服",avatar:n.config.avatar?.assistant,onClose:y},null,8,["title","avatar"]),e.createElementVNode("div",{class:"cs-messages-container",ref_key:"messagesContainer",ref:r},[e.createVNode(ee,{"welcome-message":n.config.welcomeMessage||"Hi，我是智能客服","quick-questions":e.unref(m),"show-welcome":n.messages.length===0,onAskQuestion:N,onRefreshQuestions:B},null,8,["welcome-message","quick-questions","show-welcome"]),n.messages.length>0?(e.openBlock(),e.createBlock(me,{key:0,messages:n.messages,config:n.config,"streaming-message-id":e.unref(c),"streaming-content":e.unref(f),onFeedback:z},null,8,["messages","config","streaming-message-id","streaming-content"])):e.createCommentVNode("",!0)],512),n.messages.length>0?(e.openBlock(),e.createBlock(ye,{key:0,"quick-questions":e.unref(i),onAskQuestion:N},null,8,["quick-questions"])):e.createCommentVNode("",!0),e.createVNode(be,{placeholder:n.config.placeholder||"你可以问我任何平台相关的问题",disabled:n.isLoading,onSend:p},null,8,["placeholder","disabled"])],2)):e.createCommentVNode("",!0)]),_:1},8,["name"]))}}),[["__scopeId","data-v-fa81ab0e"]]),Me=x(e.defineComponent({__name:"ChatSDKApp",props:{sdk:{type:Object,required:!0}},setup(n){return(s,t)=>(e.openBlock(),e.createBlock(Ve,{"is-open":n.sdk.isOpen.value,config:n.sdk.config,messages:n.sdk.messages.value,"is-loading":n.sdk.isLoading.value,onClose:t[0]||(t[0]=a=>n.sdk.close()),onSendMessage:t[1]||(t[1]=a=>n.sdk.handleSendMessage(a)),onAskQuestion:t[2]||(t[2]=a=>n.sdk.handleAskQuestion(a)),onFeedback:t[3]||(t[3]=(a,o)=>n.sdk.handleFeedback({messageId:a,type:o})),onStreamingComplete:t[4]||(t[4]=(a,o)=>n.sdk.handleStreamingComplete(a,o))},null,8,["is-open","config","messages","is-loading"]))}}),[["__scopeId","data-v-87cbd1c8"]]);function Q(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}function M(n,s){const t={...n};for(const a in s)s[a]&&typeof s[a]=="object"&&!Array.isArray(s[a])&&a in n&&n[a]&&typeof n[a]=="object"&&!Array.isArray(n[a])?t[a]=M(n[a],s[a]):t[a]=s[a];return t}const q=`.cs-header[data-v-c3c54fb3]{height:60px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;background-color:#f0f5ff;border-bottom:1px solid rgba(0,0,0,.05);flex-shrink:0}.cs-header-left[data-v-c3c54fb3]{display:flex;align-items:center;gap:12px}.cs-avatar[data-v-c3c54fb3]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}.cs-avatar svg[data-v-c3c54fb3]{width:24px;height:24px}.cs-avatar-img[data-v-c3c54fb3]{width:100%;height:100%;object-fit:cover}.cs-title[data-v-c3c54fb3]{font-size:18px;font-weight:600;color:#1a1a1a}.cs-header-right[data-v-c3c54fb3]{display:flex;align-items:center;gap:8px}.cs-icon-btn[data-v-c3c54fb3]{width:36px;height:36px;border:none;background:transparent;border-radius:50%;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-icon-btn[data-v-c3c54fb3]:hover{background-color:#0000000d;color:#1a1a1a}.cs-icon-btn[data-v-c3c54fb3]:active{transform:scale(.95)}.cs-icon-btn svg[data-v-c3c54fb3]{width:24px;height:24px}.cs-close-btn[data-v-c3c54fb3]{color:#9ca3af}.cs-close-btn[data-v-c3c54fb3]:hover{background-color:#0000000d;color:#1a1a1a}.cs-welcome-section[data-v-d56a62e7]{padding:16px}.cs-welcome-card[data-v-d56a62e7]{background:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 12px #00000014;display:flex;flex-direction:column;gap:12px}.cs-welcome-header[data-v-d56a62e7]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding-bottom:12px;border-bottom:1px solid rgba(0,0,0,.08)}.cs-welcome-left[data-v-d56a62e7]{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.cs-avatar[data-v-d56a62e7]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#fff;box-shadow:0 2px 8px #3b82f633}.cs-avatar svg[data-v-d56a62e7]{width:24px;height:24px}.cs-welcome-text[data-v-d56a62e7]{flex:1;min-width:0}.cs-welcome-title[data-v-d56a62e7]{font-size:16px;font-weight:600;color:#1a1a1a;line-height:1.4;margin-bottom:2px}.cs-welcome-subtitle[data-v-d56a62e7]{font-size:12px;color:#9ca3af;line-height:1.4}.cs-refresh-btn[data-v-d56a62e7]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;background:transparent;border:none;border-radius:8px;color:#3b82f6;font-size:11px;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0;white-space:nowrap}.cs-refresh-btn[data-v-d56a62e7]:hover{background-color:#3b82f614}.cs-refresh-btn[data-v-d56a62e7]:active{transform:scale(.95)}.cs-refresh-btn svg[data-v-d56a62e7]{width:18px;height:18px;transition:transform .5s ease}.cs-refresh-btn svg.rotate-animating[data-v-d56a62e7]{animation:rotate-d56a62e7 .5s ease-in-out}.cs-refresh-btn span[data-v-d56a62e7]{font-size:11px}@keyframes rotate-d56a62e7{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.cs-questions-list[data-v-d56a62e7]{display:flex;flex-direction:column;gap:8px}.cs-question-item[data-v-d56a62e7]{background:#f0f5ff;border-radius:12px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-question-item[data-v-d56a62e7]:hover{background:#f3f4f6}.cs-question-item[data-v-d56a62e7]:active{transform:scale(.98)}.cs-question-text[data-v-d56a62e7]{flex:1;font-size:14px;color:#1a1a1a;line-height:1.5;word-break:break-word}@media(max-width:480px){.cs-welcome-section[data-v-d56a62e7],.cs-welcome-card[data-v-d56a62e7]{padding:12px}.cs-welcome-title[data-v-d56a62e7]{font-size:14px}.cs-welcome-subtitle[data-v-d56a62e7],.cs-question-text[data-v-d56a62e7]{font-size:12px}}.cs-message-item[data-v-ee56945d]{display:flex;gap:8px;margin-bottom:4px}.cs-message-assistant[data-v-ee56945d]{justify-content:flex-start}.cs-message-user[data-v-ee56945d]{justify-content:flex-end}.cs-message-avatar[data-v-ee56945d]{flex-shrink:0;display:flex;align-items:flex-start}.cs-avatar[data-v-ee56945d]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}.cs-avatar svg[data-v-ee56945d]{width:20px;height:20px}.cs-avatar-assistant[data-v-ee56945d]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.cs-avatar-user[data-v-ee56945d]{background:linear-gradient(135deg,#9ca3af,#6b7280);color:#fff}.cs-avatar-img[data-v-ee56945d]{width:100%;height:100%;object-fit:cover}.cs-message-wrapper[data-v-ee56945d]{display:flex;flex-direction:column;gap:4px;max-width:75%}.cs-message-bubble[data-v-ee56945d]{padding:12px 16px;border-radius:12px;position:relative;word-wrap:break-word;overflow-wrap:break-word}.cs-bubble-assistant[data-v-ee56945d]{background:#fff;color:#1a1a1a;border-bottom-left-radius:4px;box-shadow:0 2px 8px #0000000a}.cs-bubble-user[data-v-ee56945d]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border-bottom-right-radius:4px;box-shadow:0 2px 8px #3b82f633}.cs-message-content[data-v-ee56945d]{font-size:15px;line-height:1.6;white-space:pre-wrap;word-break:break-word}.cs-bubble-user .cs-message-content[data-v-ee56945d]{color:#fff}.cs-streaming-indicator[data-v-ee56945d]{display:inline-flex;align-items:center;gap:4px;margin-left:8px;vertical-align:middle}.cs-dot[data-v-ee56945d]{width:6px;height:6px;border-radius:50%;background-color:currentColor;animation:dotBounce-ee56945d 1.4s infinite ease-in-out both}.cs-dot[data-v-ee56945d]:nth-child(1){animation-delay:-.32s}.cs-dot[data-v-ee56945d]:nth-child(2){animation-delay:-.16s}@keyframes dotBounce-ee56945d{0%,80%,to{transform:scale(.8);opacity:.5}40%{transform:scale(1);opacity:1}}.cs-feedback-actions[data-v-ee56945d]{display:flex;gap:12px;padding-left:4px}.cs-feedback-btn[data-v-ee56945d]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid rgba(0,0,0,.08);background:#fff;border-radius:4px;color:#9ca3af;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-feedback-btn svg[data-v-ee56945d]{width:8px;height:8px}.cs-feedback-btn[data-v-ee56945d]:hover{border-color:#3b82f6;color:#3b82f6;background:#3b82f60d}.cs-feedback-btn[data-v-ee56945d]:active{transform:scale(.95)}.cs-feedback-btn-active[data-v-ee56945d]{background:#3b82f6;border-color:#3b82f6;color:#fff}.cs-feedback-btn-active[data-v-ee56945d]:hover{background:#2563eb;border-color:#2563eb;color:#fff}@media(max-width:480px){.cs-message-wrapper[data-v-ee56945d]{max-width:80%}.cs-message-content[data-v-ee56945d]{font-size:14px}}.cs-messages-list[data-v-531b4005]{display:flex;flex-direction:column;gap:12px}.cs-input-container[data-v-582889fb]{height:70px;padding:12px 16px;background-color:#f0f5ff;border-top:1px solid rgba(0,0,0,.05);flex-shrink:0}.cs-input-wrapper[data-v-582889fb]{display:flex;align-items:center;gap:12px;height:100%}.cs-input[data-v-582889fb]{flex:1;height:46px;padding:0 16px;background:#fff;border:none;border-radius:23px;font-size:15px;color:#1a1a1a;outline:none;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-input[data-v-582889fb]::placeholder{color:#9ca3af;font-size:14px}.cs-input[data-v-582889fb]:focus{box-shadow:0 0 0 2px #3b82f633}.cs-input[data-v-582889fb]:disabled{background-color:#f3f4f6;cursor:not-allowed}.cs-send-btn[data-v-582889fb]{width:46px;height:46px;border:none;border-radius:50%;background-color:#e5e7eb;color:#9ca3af;cursor:not-allowed;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0}.cs-send-btn svg[data-v-582889fb]{width:24px;height:24px}.cs-send-btn[data-v-582889fb]:disabled{cursor:not-allowed;transform:none}.cs-send-btn-active[data-v-582889fb]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;cursor:pointer;box-shadow:0 4px 12px #3b82f64d}.cs-send-btn-active[data-v-582889fb]:hover{box-shadow:0 6px 20px #667eea66;transform:scale(1.05)}.cs-send-btn-active[data-v-582889fb]:active{transform:scale(.95)}@media(max-width:480px){.cs-input-container[data-v-582889fb]{padding:10px 12px}.cs-input[data-v-582889fb]{height:42px;font-size:14px}.cs-send-btn[data-v-582889fb]{width:42px;height:42px}.cs-send-btn svg[data-v-582889fb]{width:22px;height:22px}}.cs-quick-questions[data-v-fc7fd5f8]{padding:12px 16px;background:#f0f5ff;border-top:1px solid rgba(0,0,0,.05)}.cs-questions-scroll[data-v-fc7fd5f8]{display:flex;gap:8px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;-ms-overflow-style:none;scrollbar-width:none}.cs-questions-scroll[data-v-fc7fd5f8]::-webkit-scrollbar{display:none}.cs-question-chip[data-v-fc7fd5f8]{display:inline-flex;align-items:center;gap:4px;padding:8px 12px;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:9999px;white-space:nowrap;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0}.cs-question-chip[data-v-fc7fd5f8]:hover{border-color:#3b82f6;color:#3b82f6;box-shadow:0 2px 8px #3b82f633}.cs-question-chip[data-v-fc7fd5f8]:active{transform:scale(.95)}.cs-question-text[data-v-fc7fd5f8]{font-size:12px;color:#1a1a1a}.cs-question-icon[data-v-fc7fd5f8]{width:8px;height:8px;flex-shrink:0;color:#9ca3af}.cs-question-chip:hover .cs-question-icon[data-v-fc7fd5f8]{color:#3b82f6}.cs-chat-window[data-v-e65cdfc5]{position:fixed;bottom:0;width:100%;height:100vh;max-height:100vh;background-color:#f0f5ff;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;z-index:200}.cs-chat-window-left[data-v-e65cdfc5]{left:0;right:auto}.cs-chat-window-right[data-v-e65cdfc5]{left:auto;right:0}.cs-messages-container[data-v-e65cdfc5]{flex:1;overflow-y:auto;overflow-x:hidden;padding:20px 16px;-webkit-overflow-scrolling:touch}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar{width:4px}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-track{background:transparent}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-thumb{background:#0000001a;border-radius:2px}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-thumb:hover{background:#0003}.cs-messages-list[data-v-e65cdfc5]{display:flex;flex-direction:column;gap:12px}.slide-right-enter-active[data-v-e65cdfc5],.slide-right-leave-active[data-v-e65cdfc5]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.slide-right-enter-from[data-v-e65cdfc5],.slide-right-leave-to[data-v-e65cdfc5]{transform:translate(100%)}.slide-left-enter-active[data-v-e65cdfc5],.slide-left-leave-active[data-v-e65cdfc5]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.slide-left-enter-from[data-v-e65cdfc5],.slide-left-leave-to[data-v-e65cdfc5]{transform:translate(-100%)}@media(min-width:768px){.cs-chat-window[data-v-e65cdfc5]{max-width:420px;bottom:20px;height:calc(100vh - 40px);max-height:800px;border-radius:16px;box-shadow:0 8px 32px #0000001a}.cs-chat-window-left[data-v-e65cdfc5]{left:20px;transform:none}.cs-chat-window-right[data-v-e65cdfc5]{right:20px;left:auto}.slide-left-enter-from[data-v-e65cdfc5],.slide-left-leave-to[data-v-e65cdfc5]{transform:translate(-100%) translateY(0)}.slide-right-enter-from[data-v-e65cdfc5],.slide-right-leave-to[data-v-e65cdfc5]{transform:translate(100%) translateY(0)}}
`,$e={title:"智能客服",placeholder:"你可以问我任何平台相关的问题",theme:"light",position:"right",welcomeMessage:"Hi，我是智能客服",quickQuestions:[],enableHistory:!0,maxHistoryDays:7,avatar:{assistant:"",user:""}};class ${app=null;container=null;shadowRoot=null;eventListeners=new Map;isOpen=e.ref(!1);config=e.reactive({});messages=e.ref([]);isLoading=e.ref(!1);unreadCount=e.ref(0);constructor(s={}){Object.assign(this.config,M($e,s)),this.loadHistory()}mount(s){if(this.app){console.warn("[ChatSDK] SDK already mounted");return}const t=typeof s=="string"?document.querySelector(s):s||document.body;if(!t){console.error("[ChatSDK] Container not found");return}this.container=document.createElement("chat-sdk-root"),this.container.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999999;
    `,t.appendChild(this.container),this.shadowRoot=this.container.attachShadow({mode:"open"}),this.injectGlobalStyles();const a=document.createElement("div");a.id="chat-sdk-mount-point",this.shadowRoot.appendChild(a),this.app=e.createApp(Me,{sdk:this}),this.app.mount(a),this.emit("mounted")}unmount(){this.app&&(this.app.unmount(),this.app=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.shadowRoot=null,this.emit("unmounted")}injectGlobalStyles(){if(!this.shadowRoot)return;const s=document.createElement("style");s.textContent=`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      #chat-sdk-mount-point {
        width: 100%;
        height: 100%;
        position: relative;
      }

      /* 恢复点击事件 - 容器设置了 pointer-events: none */
      #chat-sdk-mount-point > * {
        pointer-events: auto;
      }

      /* SVG 全局样式 - 确保在 Shadow DOM 中正确显示 */
      svg {
        display: inline-block;
        vertical-align: middle;
        overflow: hidden;
        /* 防止无尺寸限制时显示过大 */
        width: 1em;
        height: 1em;
      }

      /* 确保内部路径不会溢出 */
      svg * {
        vector-effect: non-scaling-stroke;
      }

      /* 确保图片正确显示 */
      img {
        display: block;
        max-width: 100%;
        height: auto;
      }

      /* 按钮重置 */
      button {
        font: inherit;
        color: inherit;
        background: none;
        border: none;
        cursor: pointer;
        outline: none;
      }

      /* 按钮内的 SVG 不继承字体相关样式 */
      button svg {
        font: normal;
        width: inherit;
        height: inherit;
      }

      /* 输入框重置 */
      input {
        font: inherit;
        color: inherit;
        outline: none;
        border: none;
        background: none;
      }

      /* 伪元素重置 */
      ::before,
      ::after {
        box-sizing: border-box;
      }
    `,this.shadowRoot.appendChild(s),this.injectComponentStyles()}injectComponentStyles(){if(this.shadowRoot&&!q.includes("请在构建时自动注入")){const s=document.createElement("style");s.textContent=q,this.shadowRoot.appendChild(s)}}open(){this.isOpen.value=!0,this.unreadCount.value=0,this.emit("open")}close(){this.isOpen.value=!1,this.emit("close")}toggle(){this.isOpen.value?this.close():this.open()}async sendMessage(s){if(s.trim()){this.addMessage({id:Q(),role:"user",content:s.trim(),timestamp:Date.now()}),this.isLoading.value=!0;try{await this.emitAsync("sendMessage",s)}catch(t){console.error("[ChatSDK] Send message error:",t),this.addMessage({id:Q(),role:"system",content:"发送消息失败，请稍后重试",timestamp:Date.now()})}finally{this.isLoading.value=!1}}}addMessage(s){this.messages.value.push(s),this.saveHistory(),!this.isOpen.value&&s.role==="assistant"&&this.unreadCount.value++,this.emit("message",s)}appendMessageContent(s,t){const a=this.messages.value.find(o=>o.id===s);a&&(a.content+=t,a.timestamp=Date.now(),this.emit("messageUpdate",a))}finishMessageStream(s){const t=this.messages.value.find(a=>a.id===s);t&&(t.isStreaming=!1,t.timestamp=Date.now(),this.saveHistory(),this.emit("messageComplete",t))}clearMessages(){this.messages.value=[],this.saveHistory(),this.emit("clear")}handleSendMessage(s){return this.sendMessage(s)}handleAskQuestion(s){this.sendMessage(s.text)}handleFeedback(s){const{messageId:t,type:a}=s,o=this.messages.value.find(l=>l.id===t);o&&o.role==="assistant"&&(o.feedback=a||void 0,this.saveHistory(),this.emit("feedback",o))}handleStreamingComplete(s,t){const a=this.messages.value.find(o=>o.id===s);a?(a.content=t,a.isStreaming=!1,a.timestamp=Date.now()):this.addMessage({id:s,role:"assistant",content:t,isStreaming:!1,timestamp:Date.now()}),this.saveHistory()}loadHistory(){if(this.config.enableHistory)try{const s=localStorage.getItem("chat-sdk-history");if(s){const t=JSON.parse(s),a=Date.now(),o=this.config.maxHistoryDays*24*60*60*1e3;this.messages.value=t.filter(l=>a-l.timestamp<o)}}catch(s){console.error("[ChatSDK] Load history error:",s)}}saveHistory(){if(this.config.enableHistory)try{localStorage.setItem("chat-sdk-history",JSON.stringify(this.messages.value))}catch(s){console.error("[ChatSDK] Save history error:",s)}}emit(s,t){const a=this.eventListeners.get(s);a&&a.forEach(o=>o(t))}async emitAsync(s,t){const a=this.eventListeners.get(s);if(a&&a.size>0){const o=Array.from(a).map(l=>Promise.resolve(l(t)));return Promise.all(o)}return Promise.resolve()}on(s,t){this.eventListeners.has(s)||this.eventListeners.set(s,new Set),this.eventListeners.get(s).add(t)}off(s,t){const a=this.eventListeners.get(s);a&&a.delete(t)}updateConfig(s){Object.assign(this.config,M(this.config,s))}}function ze(n){return new $(n)}b.ChatSDK=$,b.createChatSDK=ze,b.default=$,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
