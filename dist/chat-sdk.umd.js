(function(c,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(c=typeof globalThis<"u"?globalThis:c||self,e(c.ChatSDK={},c.Vue))})(this,(function(c,e){"use strict";const w={class:"cs-header"},S={class:"cs-header-left"},N={class:"cs-avatar"},V={key:0,viewBox:"0 0 24 24",fill:"currentColor"},B=["src"],$={class:"cs-title"},D={class:"cs-header-right"},M=e.defineComponent({__name:"ChatHeader",props:{title:{default:"智能客服"},avatar:{}},emits:["close","menu"],setup(o){return(n,t)=>(e.openBlock(),e.createElementBlock("div",w,[e.createElementVNode("div",S,[e.createElementVNode("div",N,[o.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:o.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,B)):(e.openBlock(),e.createElementBlock("svg",V,[...t[2]||(t[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))]),e.createElementVNode("span",$,e.toDisplayString(o.title),1)]),e.createElementVNode("div",D,[e.createElementVNode("button",{class:"cs-icon-btn",onClick:t[0]||(t[0]=s=>n.$emit("menu"))},[...t[3]||(t[3]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})],-1)])]),e.createElementVNode("button",{class:"cs-icon-btn cs-close-btn",onClick:t[1]||(t[1]=s=>n.$emit("close"))},[...t[4]||(t[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])])]))}}),x={class:"cs-welcome-section"},L={class:"cs-welcome-card"},Q={class:"cs-welcome-content"},z={class:"cs-welcome-title"},A={class:"cs-questions-list"},q=["onClick"],H={class:"cs-question-text"},v=e.defineComponent({__name:"WelcomeSection",props:{welcomeMessage:{default:"Hi，我是智能客服"},quickQuestions:{default:()=>[]}},emits:["askQuestion","refreshQuestions"],setup(o,{emit:n}){const t=n,s=i=>{t("askQuestion",i)};return(i,a)=>(e.openBlock(),e.createElementBlock("div",x,[e.createElementVNode("div",L,[e.createElementVNode("div",Q,[e.createElementVNode("div",z,e.toDisplayString(o.welcomeMessage),1),a[1]||(a[1]=e.createElementVNode("div",{class:"cs-welcome-subtitle"},"你可以试着问我：",-1))]),e.createElementVNode("button",{class:"cs-refresh-btn",onClick:a[0]||(a[0]=l=>i.$emit("refreshQuestions"))},[...a[2]||(a[2]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),e.createElementVNode("span",null,"换一换",-1)])])]),e.createElementVNode("div",A,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.quickQuestions,l=>(e.openBlock(),e.createElementBlock("div",{key:l.id,class:"cs-question-item",onClick:r=>s(l)},[e.createElementVNode("div",H,e.toDisplayString(l.text),1),a[3]||(a[3]=e.createElementVNode("button",{class:"cs-ask-btn"},"提问",-1))],8,q))),128))])]))}}),T={key:0,class:"cs-message-avatar"},K={class:"cs-avatar cs-avatar-assistant"},O={key:0,viewBox:"0 0 24 24",fill:"currentColor"},I=["src"],R={class:"cs-message-wrapper"},j={class:"cs-message-content"},F={key:0,class:"cs-streaming-indicator"},G={key:0,class:"cs-feedback-actions"},P={key:1,class:"cs-message-avatar"},U=e.defineComponent({__name:"MessageItem",props:{message:{},avatar:{}},emits:["feedback"],setup(o,{emit:n}){const t=o,s=n,i=a=>{t.message.feedback===a?s("feedback",t.message.id,null):s("feedback",t.message.id,a)};return(a,l)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cs-message-item",`cs-message-${o.message.role}`])},[o.message.role==="assistant"?(e.openBlock(),e.createElementBlock("div",T,[e.createElementVNode("div",K,[o.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:o.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,I)):(e.openBlock(),e.createElementBlock("svg",O,[...l[2]||(l[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))])])):e.createCommentVNode("",!0),e.createElementVNode("div",R,[e.createElementVNode("div",{class:e.normalizeClass(["cs-message-bubble",`cs-bubble-${o.message.role}`])},[e.createElementVNode("div",j,e.toDisplayString(o.message.content),1),o.message.isStreaming?(e.openBlock(),e.createElementBlock("div",F,[...l[3]||(l[3]=[e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1)])])):e.createCommentVNode("",!0)],2),o.message.role==="assistant"&&!o.message.isStreaming?(e.openBlock(),e.createElementBlock("div",G,[e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":o.message.feedback==="like"}]),onClick:l[0]||(l[0]=r=>i("like"))},[...l[4]||(l[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})],-1)])],2),e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":o.message.feedback==="dislike"}]),onClick:l[1]||(l[1]=r=>i("dislike"))},[...l[5]||(l[5]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"})],-1)])],2)])):e.createCommentVNode("",!0)]),o.message.role==="user"?(e.openBlock(),e.createElementBlock("div",P,[...l[6]||(l[6]=[e.createElementVNode("div",{class:"cs-avatar cs-avatar-user"},[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)])])):e.createCommentVNode("",!0)],2))}}),J={class:"cs-input-container"},W={class:"cs-input-wrapper"},X=["placeholder","disabled"],Y=["disabled"],Z=e.defineComponent({__name:"MessageInput",props:{placeholder:{default:"你可以问我任何平台相关的问题"},disabled:{type:Boolean,default:!1}},emits:["send"],setup(o,{expose:n,emit:t}){const s=o,i=t,a=e.ref(""),l=e.ref(),r=e.computed(()=>a.value.trim().length>0),g=()=>{},u=()=>{const h=a.value.trim();h&&!s.disabled&&(i("send",h),a.value="")};return n({focus:()=>{e.nextTick(()=>{l.value?.focus()})}}),(h,m)=>(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("div",W,[e.withDirectives(e.createElementVNode("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":m[0]||(m[0]=k=>a.value=k),type:"text",class:"cs-input",placeholder:o.placeholder,disabled:o.disabled,onKeydown:e.withKeys(u,["enter"]),onInput:g},null,40,X),[[e.vModelText,a.value]]),e.createElementVNode("button",{class:e.normalizeClass(["cs-send-btn",{"cs-send-btn-active":r.value}]),disabled:o.disabled||!r.value,onClick:u},[...m[1]||(m[1]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])],10,Y)])]))}}),_={key:0,class:"cs-quick-questions"},ee={class:"cs-questions-scroll",ref:"scrollContainer"},te=["onClick"],se={class:"cs-question-text"},ne=e.defineComponent({__name:"QuickQuestions",props:{quickQuestions:{default:()=>[]}},emits:["askQuestion"],setup(o){return(n,t)=>o.quickQuestions.length>0?(e.openBlock(),e.createElementBlock("div",_,[e.createElementVNode("div",ee,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.quickQuestions,s=>(e.openBlock(),e.createElementBlock("div",{key:s.id,class:"cs-question-chip",onClick:i=>n.$emit("askQuestion",s)},[e.createElementVNode("span",se,e.toDisplayString(s.text),1),t[0]||(t[0]=e.createElementVNode("svg",{class:"cs-question-icon",viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1))],8,te))),128))],512)])):e.createCommentVNode("",!0)}}),oe={key:1,class:"cs-messages-list"},ie=e.defineComponent({__name:"ChatWindow",props:{isOpen:{type:Boolean},config:{},messages:{},isLoading:{type:Boolean,default:!1}},emits:["close","sendMessage","askQuestion","feedback"],setup(o,{emit:n}){const t=o,s=n,i=e.ref(),a=e.ref([]),l=e.ref([]),r=e.ref(0),g=e.computed(()=>t.config.position||"right"),u=e.computed(()=>g.value==="left"?"slide-left":"slide-right"),C=()=>{const d=t.config.quickQuestions||[];a.value=d.length>0?d:h()},h=()=>[{id:"1",text:"如何使用这个平台？"},{id:"2",text:"账号如何注册？"},{id:"3",text:"忘记密码怎么办？"},{id:"4",text:"如何联系人工客服？"}],m=()=>{r.value=(r.value+1)%l.value.length,a.value=l.value[r.value]??[]},k=d=>{s("askQuestion",d)},he=(d,E)=>{s("feedback",d,E)},fe=d=>{s("sendMessage",d)},ge=()=>{s("close")},ue=()=>{e.nextTick(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight)})};return e.watch(()=>t.messages,ue,{deep:!0}),e.onMounted(()=>{C()}),(d,E)=>(e.openBlock(),e.createBlock(e.Transition,{name:u.value},{default:e.withCtx(()=>[o.isOpen?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["cs-chat-window",`cs-chat-window-${g.value}`])},[e.createVNode(M,{title:o.config.title||"智能客服",avatar:o.config.avatar?.assistant,onClose:ge},null,8,["title","avatar"]),e.createElementVNode("div",{class:"cs-messages-container",ref_key:"messagesContainer",ref:i},[o.messages.length===0?(e.openBlock(),e.createBlock(v,{key:0,"welcome-message":o.config.welcomeMessage||"Hi，我是智能客服","quick-questions":a.value,onAskQuestion:k,onRefreshQuestions:m},null,8,["welcome-message","quick-questions"])):(e.openBlock(),e.createElementBlock("div",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.messages,b=>(e.openBlock(),e.createBlock(U,{key:b.id,message:b,avatar:b.role==="assistant"?o.config.avatar?.assistant:o.config.avatar?.user,onFeedback:he},null,8,["message","avatar"]))),128))]))],512),o.messages.length>0?(e.openBlock(),e.createBlock(ne,{key:0,"quick-questions":a.value,onAskQuestion:k},null,8,["quick-questions"])):e.createCommentVNode("",!0),e.createVNode(Z,{placeholder:o.config.placeholder||"你可以问我任何平台相关的问题",disabled:o.isLoading,onSend:fe},null,8,["placeholder","disabled"])],2)):e.createCommentVNode("",!0)]),_:1},8,["name"]))}}),ae=((o,n)=>{const t=o.__vccOpts||o;for(const[s,i]of n)t[s]=i;return t})(e.defineComponent({__name:"SDKApp",props:{sdk:{type:Object,required:!0}},setup(o){return(n,t)=>(e.openBlock(),e.createBlock(ie,{"is-open":o.sdk.isOpen.value,config:o.sdk.config,messages:o.sdk.messages.value,"is-loading":o.sdk.isLoading.value,onClose:t[0]||(t[0]=s=>o.sdk.close()),onSendMessage:t[1]||(t[1]=s=>o.sdk.handleSendMessage(s)),onAskQuestion:t[2]||(t[2]=s=>o.sdk.handleAskQuestion(s)),onFeedback:t[3]||(t[3]=(s,i)=>o.sdk.handleFeedback({messageId:s,type:i}))},null,8,["is-open","config","messages","is-loading"]))}}),[["__scopeId","data-v-63424d60"]]);function p(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}function le(o){const n=new Date(o),t=new Date,s=t.getTime()-n.getTime();if(s<60*1e3)return"刚刚";if(s<3600*1e3)return`${Math.floor(s/(60*1e3))}分钟前`;if(n.toDateString()===t.toDateString())return n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const i=new Date(t);return i.setDate(i.getDate()-1),n.toDateString()===i.toDateString()?`昨天 ${n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}`:n.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function f(o,n){const t={...o};for(const s in n)n[s]&&typeof n[s]=="object"&&!Array.isArray(n[s])&&s in o&&o[s]&&typeof o[s]=="object"&&!Array.isArray(o[s])?t[s]=f(o[s],n[s]):t[s]=n[s];return t}function ce(o,n){let t=null;return function(...s){t&&clearTimeout(t),t=setTimeout(()=>o.apply(this,s),n)}}function re(o,n){let t=null,s=0;return function(...i){const a=Date.now(),l=n-(a-s);l<=0?(t&&(clearTimeout(t),t=null),s=a,o.apply(this,i)):t||(t=setTimeout(()=>{s=Date.now(),t=null,o.apply(this,i)},l))}}const de={title:"智能客服",placeholder:"你可以问我任何平台相关的问题",theme:"light",position:"right",welcomeMessage:"Hi，我是智能客服",quickQuestions:[],enableHistory:!0,maxHistoryDays:7,avatar:{assistant:"",user:""}};class y{app=null;container=null;shadowRoot=null;eventListeners=new Map;isOpen=e.ref(!1);config=e.reactive({});messages=e.ref([]);isLoading=e.ref(!1);unreadCount=e.ref(0);constructor(n={}){Object.assign(this.config,f(de,n)),this.loadHistory()}mount(n){if(this.app){console.warn("[ChatSDK] SDK already mounted");return}const t=typeof n=="string"?document.querySelector(n):n||document.body;if(!t){console.error("[ChatSDK] Container not found");return}this.container=document.createElement("chat-sdk-root"),this.container.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999999;
    `,t.appendChild(this.container),this.shadowRoot=this.container.attachShadow({mode:"open"}),this.injectGlobalStyles();const s=document.createElement("div");s.id="chat-sdk-mount-point",this.shadowRoot.appendChild(s),this.app=e.createApp(ae,{sdk:this}),this.app.mount(s),this.emit("mounted")}unmount(){this.app&&(this.app.unmount(),this.app=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.shadowRoot=null,this.emit("unmounted")}injectGlobalStyles(){if(!this.shadowRoot)return;const n=document.createElement("style");n.textContent=`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      #chat-sdk-mount-point {
        width: 100%;
        height: 100%;
        position: relative;
      }

      /* 恢复点击事件 - 容器设置了 pointer-events: none */
      #chat-sdk-mount-point > * {
        pointer-events: auto;
      }

      /* SVG 全局样式 - 确保在 Shadow DOM 中正确显示 */
      svg {
        display: inline-block;
        vertical-align: middle;
        overflow: hidden;
        /* 防止无尺寸限制时显示过大 */
        width: 1em;
        height: 1em;
      }

      /* 确保内部路径不会溢出 */
      svg * {
        vector-effect: non-scaling-stroke;
      }

      /* 确保图片正确显示 */
      img {
        display: block;
        max-width: 100%;
        height: auto;
      }

      /* 按钮重置 */
      button {
        font: inherit;
        color: inherit;
        background: none;
        border: none;
        cursor: pointer;
        outline: none;
      }

      /* 按钮内的 SVG 不继承字体相关样式 */
      button svg {
        font: normal;
        width: inherit;
        height: inherit;
      }

      /* 输入框重置 */
      input {
        font: inherit;
        color: inherit;
        outline: none;
        border: none;
        background: none;
      }

      /* 伪元素重置 */
      ::before,
      ::after {
        box-sizing: border-box;
      }
    `,this.shadowRoot.appendChild(n),this.loadComponentStyles()}loadComponentStyles(){if(!this.shadowRoot)return;Array.from(document.querySelectorAll('link[rel="stylesheet"]')).forEach(t=>{const s=t.getAttribute("href");if(s&&s.includes("ai-bot")){const i=document.createElement("link");i.rel="stylesheet",i.href=s,this.shadowRoot.appendChild(i),console.log("[ChatSDK] Loaded stylesheet:",s)}})}injectComponentStyles(){if(!this.shadowRoot)return;Array.from(document.querySelectorAll("style")).forEach(t=>{const s=t.textContent||"";if(s.includes(".cs-")||s.includes(".chat-sdk")){const i=t.getAttribute("data-vite-dev-id");if(!Array.from(this.shadowRoot.querySelectorAll("style")).some(l=>l.getAttribute("data-vite-dev-id")===i)){const l=t.cloneNode(!0);this.shadowRoot.appendChild(l),console.log("[ChatSDK] Injected component style:",i||"unknown")}}})}open(){this.isOpen.value=!0,this.unreadCount.value=0,this.emit("open")}close(){this.isOpen.value=!1,this.emit("close")}toggle(){this.isOpen.value?this.close():this.open()}async sendMessage(n){if(n.trim()){this.addMessage({id:p(),role:"user",content:n.trim(),timestamp:Date.now()}),this.isLoading.value=!0;try{await this.emitAsync("sendMessage",n)}catch(t){console.error("[ChatSDK] Send message error:",t),this.addMessage({id:p(),role:"system",content:"发送消息失败，请稍后重试",timestamp:Date.now()})}finally{this.isLoading.value=!1}}}addMessage(n){this.messages.value.push(n),this.saveHistory(),!this.isOpen.value&&n.role==="assistant"&&this.unreadCount.value++,this.emit("message",n)}appendMessageContent(n,t){const s=this.messages.value.find(i=>i.id===n);s&&(s.content+=t,s.timestamp=Date.now(),this.emit("messageUpdate",s))}finishMessageStream(n){const t=this.messages.value.find(s=>s.id===n);t&&(t.isStreaming=!1,t.timestamp=Date.now(),this.saveHistory(),this.emit("messageComplete",t))}clearMessages(){this.messages.value=[],this.saveHistory(),this.emit("clear")}handleSendMessage(n){return this.sendMessage(n)}handleAskQuestion(n){this.sendMessage(n.text)}handleFeedback(n){const{messageId:t,type:s}=n,i=this.messages.value.find(a=>a.id===t);i&&i.role==="assistant"&&(i.feedback=s||void 0,this.saveHistory(),this.emit("feedback",i))}loadHistory(){if(this.config.enableHistory)try{const n=localStorage.getItem("chat-sdk-history");if(n){const t=JSON.parse(n),s=Date.now(),i=this.config.maxHistoryDays*24*60*60*1e3;this.messages.value=t.filter(a=>s-a.timestamp<i)}}catch(n){console.error("[ChatSDK] Load history error:",n)}}saveHistory(){if(this.config.enableHistory)try{localStorage.setItem("chat-sdk-history",JSON.stringify(this.messages.value))}catch(n){console.error("[ChatSDK] Save history error:",n)}}emit(n,t){const s=this.eventListeners.get(n);s&&s.forEach(i=>i(t))}async emitAsync(n,t){const s=this.eventListeners.get(n);if(s&&s.size>0){const i=Array.from(s).map(a=>Promise.resolve(a(t)));return Promise.all(i)}return Promise.resolve()}on(n,t){this.eventListeners.has(n)||this.eventListeners.set(n,new Set),this.eventListeners.get(n).add(t)}off(n,t){const s=this.eventListeners.get(n);s&&s.delete(t)}updateConfig(n){Object.assign(this.config,f(this.config,n))}}function me(o){return new y(o)}c.ChatSDK=y,c.createChatSDK=me,c.debounce=ce,c.deepMerge=f,c.default=y,c.formatTimestamp=le,c.generateId=p,c.throttle=re,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
