(function(x,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(x=typeof globalThis<"u"?globalThis:x||self,e(x.ChatSDK={},x.Vue))})(this,(function(x,e){"use strict";const U={class:"cs-header"},W={class:"cs-header-left"},R={class:"cs-avatar"},G={key:0,viewBox:"0 0 24 24",fill:"currentColor"},J=["src"],Y={class:"cs-title"},X={class:"cs-header-right"},Z=e.defineComponent({__name:"ChatHeader",props:{title:{default:"智能客服"},avatar:{}},emits:["close","menu"],setup(t){return(s,n)=>(e.openBlock(),e.createElementBlock("div",U,[e.createElementVNode("div",W,[e.createElementVNode("div",R,[t.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:t.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,J)):(e.openBlock(),e.createElementBlock("svg",G,[...n[2]||(n[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))]),e.createElementVNode("span",Y,e.toDisplayString(t.title),1)]),e.createElementVNode("div",X,[e.createElementVNode("button",{class:"cs-icon-btn",onClick:n[0]||(n[0]=a=>s.$emit("menu"))},[...n[3]||(n[3]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})],-1)])]),e.createElementVNode("button",{class:"cs-icon-btn cs-close-btn",onClick:n[1]||(n[1]=a=>s.$emit("close"))},[...n[4]||(n[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])])]))}}),k=(t,s)=>{const n=t.__vccOpts||t;for(const[a,o]of s)n[a]=o;return n},ee=k(Z,[["__scopeId","data-v-c3c54fb3"]]),te={class:"cs-welcome-section"},se={class:"cs-welcome-card"},ae={class:"cs-welcome-header"},ne={class:"cs-welcome-left"},oe={class:"cs-welcome-text"},ie={class:"cs-welcome-title"},ce={key:0,class:"cs-welcome-subtitle"},re={class:"cs-questions-list"},le=["onClick"],de={class:"cs-question-text"},fe=k(e.defineComponent({__name:"WelcomeSection",props:{welcomeMessage:{default:"Hi，我是智能客服"},quickQuestions:{default:()=>[]},showWelcome:{type:Boolean,default:!0}},emits:["askQuestion","refreshQuestions"],setup(t,{emit:s}){const n=s,a=e.ref(!1),o=c=>{n("askQuestion",c)},r=()=>{a.value=!0,setTimeout(()=>{a.value=!1},500),n("refreshQuestions")};return(c,l)=>(e.openBlock(),e.createElementBlock("div",te,[e.createElementVNode("div",se,[e.createElementVNode("div",ae,[e.createElementVNode("div",ne,[l[0]||(l[0]=e.createElementVNode("div",{class:"cs-avatar"},[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),e.createElementVNode("div",oe,[e.createElementVNode("div",ie,e.toDisplayString(t.welcomeMessage),1),t.showWelcome?(e.openBlock(),e.createElementBlock("div",ce,"你可以试着问我：")):e.createCommentVNode("",!0)])]),e.createElementVNode("button",{class:"cs-refresh-btn",onClick:r},[(e.openBlock(),e.createElementBlock("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:e.normalizeClass({"rotate-animating":a.value})},[...l[1]||(l[1]=[e.createElementVNode("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"},null,-1)])],2)),l[2]||(l[2]=e.createElementVNode("span",null,"换一换",-1))])]),e.createElementVNode("div",re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.quickQuestions,i=>(e.openBlock(),e.createElementBlock("div",{key:i.id,class:"cs-question-item",onClick:m=>o(i)},[e.createElementVNode("div",de,e.toDisplayString(i.text),1)],8,le))),128))])])]))}}),[["__scopeId","data-v-d56a62e7"]]),me={key:0,class:"cs-message-avatar"},he={class:"cs-avatar cs-avatar-assistant"},pe={key:0,viewBox:"0 0 24 24",fill:"currentColor"},ge=["src"],ue={class:"cs-message-wrapper"},be={class:"cs-message-content"},xe={key:0,class:"cs-streaming-indicator"},ke={key:0,class:"cs-feedback-actions"},ve={key:1,class:"cs-message-avatar"},we=k(e.defineComponent({__name:"MessageItem",props:{message:{},avatar:{}},emits:["feedback"],setup(t,{emit:s}){const n=t,a=s,o=r=>{n.message.feedback===r?a("feedback",n.message.id,null):a("feedback",n.message.id,r)};return(r,c)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["cs-message-item",`cs-message-${t.message.role}`])},[t.message.role==="assistant"?(e.openBlock(),e.createElementBlock("div",me,[e.createElementVNode("div",he,[t.avatar?(e.openBlock(),e.createElementBlock("img",{key:1,src:t.avatar,alt:"智能客服",class:"cs-avatar-img"},null,8,ge)):(e.openBlock(),e.createElementBlock("svg",pe,[...c[2]||(c[2]=[e.createElementVNode("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])]))])])):e.createCommentVNode("",!0),e.createElementVNode("div",ue,[e.createElementVNode("div",{class:e.normalizeClass(["cs-message-bubble",`cs-bubble-${t.message.role}`])},[e.createElementVNode("div",be,e.toDisplayString(t.message.content),1),t.message.isStreaming?(e.openBlock(),e.createElementBlock("div",xe,[...c[3]||(c[3]=[e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1),e.createElementVNode("span",{class:"cs-dot"},null,-1)])])):e.createCommentVNode("",!0)],2),t.message.role==="assistant"&&!t.message.isStreaming?(e.openBlock(),e.createElementBlock("div",ke,[e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":t.message.feedback==="like"}]),onClick:c[0]||(c[0]=l=>o("like"))},[...c[4]||(c[4]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})],-1)])],2),e.createElementVNode("button",{class:e.normalizeClass(["cs-feedback-btn",{"cs-feedback-btn-active":t.message.feedback==="dislike"}]),onClick:c[1]||(c[1]=l=>o("dislike"))},[...c[5]||(c[5]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e.createElementVNode("path",{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"})],-1)])],2)])):e.createCommentVNode("",!0)]),t.message.role==="user"?(e.openBlock(),e.createElementBlock("div",ve,[...c[6]||(c[6]=[e.createElementVNode("div",{class:"cs-avatar cs-avatar-user"},[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)])])):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-ee56945d"]]),ye={class:"cs-messages-list"},Ce=k(e.defineComponent({__name:"MessagesList",props:{messages:{},config:{},streamingMessageId:{default:void 0},streamingContent:{default:""}},emits:["feedback"],setup(t,{emit:s}){const n=t,a=s,o=e.ref("");e.watch(()=>n.streamingContent,i=>{i?o.value=i:o.value=""},{immediate:!0}),e.watch(()=>n.streamingMessageId,(i,m)=>{i!==m&&(o.value="")});const r=e.computed(()=>{const i=[...n.messages];if(n.streamingMessageId&&o.value){const m=i.findIndex(d=>d.id===n.streamingMessageId);if(m>=0){const d=i[m];i[m]={id:d.id,role:d.role,content:o.value,isStreaming:!0,timestamp:d.timestamp,feedback:d.feedback}}else i.push({id:n.streamingMessageId,role:"assistant",content:o.value,isStreaming:!0,timestamp:Date.now()})}return i}),c=i=>{if(i.role==="assistant")return n.config.avatar?.assistant;if(i.role==="user")return n.config.avatar?.user},l=(i,m)=>{a("feedback",i,m)};return(i,m)=>(e.openBlock(),e.createElementBlock("div",ye,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,d=>(e.openBlock(),e.createBlock(we,{key:d.id,message:d,avatar:c(d),onFeedback:l},null,8,["message","avatar"]))),128))]))}}),[["__scopeId","data-v-531b4005"]]),Se={class:"cs-input-container"},Ee={class:"cs-input-wrapper"},Be=["placeholder","disabled"],Ne=["disabled"],Ve=k(e.defineComponent({__name:"MessageInput",props:{placeholder:{default:"你可以问我任何平台相关的问题"},disabled:{type:Boolean,default:!1}},emits:["send"],setup(t,{expose:s,emit:n}){const a=n,o=e.ref(""),r=e.ref(),c=e.computed(()=>o.value.trim().length>0),l=()=>{},i=()=>{const d=o.value.trim();d&&(o.value="",a("send",d))};return s({focus:()=>{e.nextTick(()=>{r.value?.focus()})}}),(d,f)=>(e.openBlock(),e.createElementBlock("div",Se,[e.createElementVNode("div",Ee,[e.withDirectives(e.createElementVNode("input",{ref_key:"inputRef",ref:r,"onUpdate:modelValue":f[0]||(f[0]=w=>o.value=w),type:"text",class:"cs-input",placeholder:t.placeholder,disabled:t.disabled,onKeydown:e.withKeys(i,["enter"]),onInput:l},null,40,Be),[[e.vModelText,o.value]]),e.createElementVNode("button",{class:e.normalizeClass(["cs-send-btn",{"cs-send-btn-active":c.value}]),disabled:t.disabled||!c.value,onClick:i},[...f[1]||(f[1]=[e.createElementVNode("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])],10,Ne)])]))}}),[["__scopeId","data-v-582889fb"]]),Me={key:0,class:"cs-quick-questions"},$e={class:"cs-questions-scroll",ref:"scrollContainer"},ze=["onClick"],_e={class:"cs-question-text"},Qe=k(e.defineComponent({__name:"QuickQuestions",props:{quickQuestions:{default:()=>[]}},emits:["askQuestion"],setup(t){return(s,n)=>t.quickQuestions.length>0?(e.openBlock(),e.createElementBlock("div",Me,[e.createElementVNode("div",$e,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.quickQuestions,a=>(e.openBlock(),e.createElementBlock("div",{key:a.id,class:"cs-question-chip",onClick:o=>s.$emit("askQuestion",a)},[e.createElementVNode("span",_e,e.toDisplayString(a.text),1)],8,ze))),128))],512)])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-fc7fd5f8"]]),qe={key:0,class:"cs-toast"},De={class:"cs-toast-content"},Te={class:"cs-toast-message"},Ie=k(e.defineComponent({__name:"index",props:{toast:{}},setup(t){return(s,n)=>(e.openBlock(),e.createBlock(e.Transition,{name:"toast-fade"},{default:e.withCtx(()=>[t.toast?(e.openBlock(),e.createElementBlock("div",qe,[e.createElementVNode("div",De,[e.createElementVNode("div",Te,e.toDisplayString(t.toast.message),1)])])):e.createCommentVNode("",!0)]),_:1}))}}),[["__scopeId","data-v-5b0eab61"]]),Le=[{id:"1",text:"如何使用这个平台？"},{id:"2",text:"账号如何注册？"},{id:"3",text:"忘记密码怎么办？"},{id:"4",text:"如何联系人工客服？"},{id:"5",text:"平台支持哪些功能？"},{id:"6",text:"如何查看使用记录？"}];function Oe(t=[]){const s=e.ref([]),n=e.ref([]),a=e.ref([]),o=e.ref(0),r=()=>{const i=t.length>0?t:Le;n.value=i,a.value=c(i,2),s.value=a.value[0]||[],o.value=0},c=(i,m)=>{const d=[];for(let f=0;f<i.length;f+=m)d.push(i.slice(f,f+m));return d},l=()=>{a.value.length!==0&&(o.value=(o.value+1)%a.value.length,s.value=a.value[o.value]??[])};return r(),{displayedQuestions:s,allQuickQuestions:n,refreshQuestions:l}}const A=t=>{if(typeof t=="object"&&t!==null){if("choices"in t&&t.choices?.[0]?.delta?.content)return t.choices[0].delta.content;if("delta"in t&&t.delta?.text)return t.delta.text;if("content"in t&&typeof t.content=="string")return t.content}return typeof t=="string"?t:""},H=t=>{if(!t.trim())return null;if(t.startsWith("data: ")){const s=t.slice(6).trim();if(s==="[DONE]")return null;try{return JSON.parse(s)}catch{return s}}return t.startsWith("event: ")||t.startsWith("id: "),null};function Ae(t={}){const s=e.ref(""),n=e.ref(!1),a=e.ref(null);let o=null,r=t;const c=async m=>{const d={...r,...m},{url:f="",method:w="POST",headers:I={},body:M,onMessage:$,onComplete:z,onError:_}=d;n.value&&l(),a.value=null,n.value=!0,o=new AbortController;let p="",b=null,B=!1;const Q=()=>{B||(B=!0,b=requestAnimationFrame(()=>{p&&(s.value+=p,p=""),B=!1,b=null}))};try{const g=await fetch(f,{method:w,headers:{"Content-Type":"application/json",Accept:"text/event-stream",...I},body:M?JSON.stringify(M):void 0,signal:o.signal});if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);if(!g.body)throw new Error("无法获取 ReadableStream");const C=g.body.getReader(),L=new TextDecoder;let S="";for(;;){const{done:h,value:u}=await C.read();if(h){if(S.trim()){const q=S.split(`
`);for(const N of q){const E=H(N);if(E){const O=A(E);O&&(p+=O,$?.(O))}}}b&&cancelAnimationFrame(b),p&&(s.value+=p,p=""),n.value=!1,z?.();break}const v=L.decode(u,{stream:!0});S+=v;const K=S.split(`
`);S=K.pop()||"";for(const q of K)if(q.trim()){const N=H(q);if(N){if(N==="[DONE]"){b&&cancelAnimationFrame(b),p&&(s.value+=p,p=""),n.value=!1,z?.();return}const E=A(N);E&&(p+=E,$?.(E),Q())}}}}catch(g){if(b&&cancelAnimationFrame(b),g.name==="AbortError"||g.message?.includes("cancel")){n.value=!1;return}const C=g instanceof Error?g:new Error(String(g));throw a.value=C,n.value=!1,_?.(C),C}finally{o=null}},l=()=>{o&&(o.abort(),o=null),n.value=!1},i=()=>{l(),s.value="",a.value=null};return e.onUnmounted(()=>{l()}),{content:s,isLoading:n,error:a,start:c,stop:l,reset:i}}function He(t,s){const n=e.ref(0);return{savedScrollTop:n,scrollToBottom:()=>{e.nextTick(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})},saveScrollPosition:()=>{t.value&&!s.value&&(n.value=t.value.scrollTop)},restoreScrollPosition:()=>{s.value||e.nextTick(()=>{t.value&&n.value>0&&(t.value.scrollTop=n.value)})},resetScrollPosition:()=>{n.value=0},watchStreamingContent:()=>{e.watch(s,()=>{e.nextTick(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})})}}}let y=null;const V=e.ref(null),je=(t,s=3e3)=>{y&&(clearTimeout(y),y=null),V.value={message:t,duration:s},s>0&&(y=setTimeout(()=>{j()},s))},j=()=>{V.value=null,y&&(clearTimeout(y),y=null)},Fe=()=>({toast:V,show:je,hide:j}),Pe=k(e.defineComponent({__name:"ChatWindow",props:{isOpen:{type:Boolean},config:{},messages:{},isLoading:{type:Boolean,default:!1},toast:{}},emits:["close","sendMessage","askQuestion","feedback","streamingComplete"],setup(t,{emit:s}){const{show:n}=Fe(),a=t,o=s,r=e.computed(()=>a.config.position||"right"),c=e.computed(()=>r.value==="left"?"slide-left":"slide-right"),l=e.ref(),{displayedQuestions:i,allQuickQuestions:m,refreshQuestions:d}=Oe(a.config.quickQuestions||[]),f=e.ref(),{content:w,start:I,reset:M}=Ae(),{saveScrollPosition:$,restoreScrollPosition:z,resetScrollPosition:_,scrollToBottom:p,watchStreamingContent:b}=He(l,w);b(),e.watch(()=>a.messages,p,{deep:!0}),e.watch(()=>a.isOpen,h=>{h&&z()}),e.onMounted(()=>{});const B=()=>{d()},Q=async(h,u)=>{M(),f.value=Date.now().toString(),await I({url:a.config.sseUrl||"http://localhost:3000/sse",method:a.config.sseMethod||"POST",body:{message:h,history:[]},onComplete:()=>{f.value&&w.value&&(u?.(f.value,w.value),_()),f.value=void 0},onError:v=>{console.error("SSE 错误:",v),n(v.message||"发生错误，请重试"),f.value&&(u?.(f.value,`错误：${v.message}`),_()),f.value=void 0}})},g=h=>{o("askQuestion",h),Q(h.text,(u,v)=>{o("streamingComplete",u,v)})},C=(h,u)=>{o("feedback",h,u)},L=h=>{o("sendMessage",h),Q(h,(u,v)=>{o("streamingComplete",u,v)})},S=()=>{$(),o("close")};return(h,u)=>(e.openBlock(),e.createBlock(e.Transition,{name:c.value},{default:e.withCtx(()=>[t.isOpen?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["cs-chat-window",`cs-chat-window-${r.value}`])},[e.createVNode(ee,{title:t.config.title||"智能客服",avatar:t.config.avatar?.assistant,onClose:S},null,8,["title","avatar"]),e.createElementVNode("div",{class:"cs-messages-container",ref_key:"messagesContainer",ref:l},[e.createVNode(fe,{"welcome-message":t.config.welcomeMessage||"Hi，我是���能客服","quick-questions":e.unref(i),"show-welcome":t.messages.length===0,onAskQuestion:g,onRefreshQuestions:B},null,8,["welcome-message","quick-questions","show-welcome"]),t.messages.length>0?(e.openBlock(),e.createBlock(Ce,{key:0,messages:t.messages,config:t.config,"streaming-message-id":f.value,"streaming-content":e.unref(w),onFeedback:C},null,8,["messages","config","streaming-message-id","streaming-content"])):e.createCommentVNode("",!0)],512),t.messages.length>0?(e.openBlock(),e.createBlock(Qe,{key:0,"quick-questions":e.unref(m),onAskQuestion:g},null,8,["quick-questions"])):e.createCommentVNode("",!0),e.createVNode(Ve,{placeholder:t.config.placeholder||"你可以问我任何平台相关的问题",disabled:t.isLoading,onSend:L},null,8,["placeholder","disabled"]),e.createVNode(Ie,{toast:t.toast||null},null,8,["toast"])],2)):e.createCommentVNode("",!0)]),_:1},8,["name"]))}}),[["__scopeId","data-v-0bc5d315"]]),Ke=k(e.defineComponent({__name:"ChatSDKApp",props:{sdk:{type:Object,required:!0}},setup(t){const s=V;return(n,a)=>(e.openBlock(),e.createBlock(Pe,{"is-open":t.sdk.isOpen.value,config:t.sdk.config,messages:t.sdk.messages.value,"is-loading":t.sdk.isLoading.value,toast:e.unref(s),onClose:a[0]||(a[0]=o=>t.sdk.close()),onSendMessage:a[1]||(a[1]=o=>t.sdk.handleSendMessage(o)),onAskQuestion:a[2]||(a[2]=o=>t.sdk.handleAskQuestion(o)),onFeedback:a[3]||(a[3]=(o,r)=>t.sdk.handleFeedback({messageId:o,type:r})),onStreamingComplete:a[4]||(a[4]=(o,r)=>t.sdk.handleStreamingComplete(o,r))},null,8,["is-open","config","messages","is-loading","toast"]))}}),[["__scopeId","data-v-bf6430c2"]]);function F(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}function D(t,s){const n={...t};for(const a in s)s[a]&&typeof s[a]=="object"&&!Array.isArray(s[a])&&a in t&&t[a]&&typeof t[a]=="object"&&!Array.isArray(t[a])?n[a]=D(t[a],s[a]):n[a]=s[a];return n}const P=`.cs-header[data-v-c3c54fb3]{height:60px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;background-color:#f0f5ff;border-bottom:1px solid rgba(0,0,0,.05);flex-shrink:0}.cs-header-left[data-v-c3c54fb3]{display:flex;align-items:center;gap:12px}.cs-avatar[data-v-c3c54fb3]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}.cs-avatar svg[data-v-c3c54fb3]{width:24px;height:24px}.cs-avatar-img[data-v-c3c54fb3]{width:100%;height:100%;object-fit:cover}.cs-title[data-v-c3c54fb3]{font-size:18px;font-weight:600;color:#1a1a1a}.cs-header-right[data-v-c3c54fb3]{display:flex;align-items:center;gap:8px}.cs-icon-btn[data-v-c3c54fb3]{width:36px;height:36px;border:none;background:transparent;border-radius:50%;color:#9ca3af;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-icon-btn[data-v-c3c54fb3]:hover{background-color:#0000000d;color:#1a1a1a}.cs-icon-btn[data-v-c3c54fb3]:active{transform:scale(.95)}.cs-icon-btn svg[data-v-c3c54fb3]{width:24px;height:24px}.cs-close-btn[data-v-c3c54fb3]{color:#9ca3af}.cs-close-btn[data-v-c3c54fb3]:hover{background-color:#0000000d;color:#1a1a1a}.cs-welcome-section[data-v-d56a62e7]{padding:16px}.cs-welcome-card[data-v-d56a62e7]{background:#fff;border-radius:16px;padding:16px;box-shadow:0 4px 12px #00000014;display:flex;flex-direction:column;gap:12px}.cs-welcome-header[data-v-d56a62e7]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding-bottom:12px;border-bottom:1px solid rgba(0,0,0,.08)}.cs-welcome-left[data-v-d56a62e7]{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.cs-avatar[data-v-d56a62e7]{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;flex-shrink:0;color:#fff;box-shadow:0 2px 8px #3b82f633}.cs-avatar svg[data-v-d56a62e7]{width:24px;height:24px}.cs-welcome-text[data-v-d56a62e7]{flex:1;min-width:0}.cs-welcome-title[data-v-d56a62e7]{font-size:16px;font-weight:600;color:#1a1a1a;line-height:1.4;margin-bottom:2px}.cs-welcome-subtitle[data-v-d56a62e7]{font-size:12px;color:#9ca3af;line-height:1.4}.cs-refresh-btn[data-v-d56a62e7]{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;background:transparent;border:none;border-radius:8px;color:#3b82f6;font-size:11px;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0;white-space:nowrap}.cs-refresh-btn[data-v-d56a62e7]:hover{background-color:#3b82f614}.cs-refresh-btn[data-v-d56a62e7]:active{transform:scale(.95)}.cs-refresh-btn svg[data-v-d56a62e7]{width:18px;height:18px;transition:transform .5s ease}.cs-refresh-btn svg.rotate-animating[data-v-d56a62e7]{animation:rotate-d56a62e7 .5s ease-in-out}.cs-refresh-btn span[data-v-d56a62e7]{font-size:11px}@keyframes rotate-d56a62e7{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.cs-questions-list[data-v-d56a62e7]{display:flex;flex-direction:column;gap:8px}.cs-question-item[data-v-d56a62e7]{background:#f0f5ff;border-radius:12px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-question-item[data-v-d56a62e7]:hover{background:#f3f4f6}.cs-question-item[data-v-d56a62e7]:active{transform:scale(.98)}.cs-question-text[data-v-d56a62e7]{flex:1;font-size:14px;color:#1a1a1a;line-height:1.5;word-break:break-word}@media(max-width:480px){.cs-welcome-section[data-v-d56a62e7],.cs-welcome-card[data-v-d56a62e7]{padding:12px}.cs-welcome-title[data-v-d56a62e7]{font-size:14px}.cs-welcome-subtitle[data-v-d56a62e7],.cs-question-text[data-v-d56a62e7]{font-size:12px}}.cs-message-item[data-v-ee56945d]{display:flex;gap:8px;margin-bottom:4px}.cs-message-assistant[data-v-ee56945d]{justify-content:flex-start}.cs-message-user[data-v-ee56945d]{justify-content:flex-end}.cs-message-avatar[data-v-ee56945d]{flex-shrink:0;display:flex;align-items:flex-start}.cs-avatar[data-v-ee56945d]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}.cs-avatar svg[data-v-ee56945d]{width:20px;height:20px}.cs-avatar-assistant[data-v-ee56945d]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}.cs-avatar-user[data-v-ee56945d]{background:linear-gradient(135deg,#9ca3af,#6b7280);color:#fff}.cs-avatar-img[data-v-ee56945d]{width:100%;height:100%;object-fit:cover}.cs-message-wrapper[data-v-ee56945d]{display:flex;flex-direction:column;gap:4px;max-width:75%}.cs-message-bubble[data-v-ee56945d]{padding:12px 16px;border-radius:12px;position:relative;word-wrap:break-word;overflow-wrap:break-word}.cs-bubble-assistant[data-v-ee56945d]{background:#fff;color:#1a1a1a;border-bottom-left-radius:4px;box-shadow:0 2px 8px #0000000a}.cs-bubble-user[data-v-ee56945d]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border-bottom-right-radius:4px;box-shadow:0 2px 8px #3b82f633}.cs-message-content[data-v-ee56945d]{font-size:15px;line-height:1.6;white-space:pre-wrap;word-break:break-word}.cs-bubble-user .cs-message-content[data-v-ee56945d]{color:#fff}.cs-streaming-indicator[data-v-ee56945d]{display:inline-flex;align-items:center;gap:4px;margin-left:8px;vertical-align:middle}.cs-dot[data-v-ee56945d]{width:6px;height:6px;border-radius:50%;background-color:currentColor;animation:dotBounce-ee56945d 1.4s infinite ease-in-out both}.cs-dot[data-v-ee56945d]:nth-child(1){animation-delay:-.32s}.cs-dot[data-v-ee56945d]:nth-child(2){animation-delay:-.16s}@keyframes dotBounce-ee56945d{0%,80%,to{transform:scale(.8);opacity:.5}40%{transform:scale(1);opacity:1}}.cs-feedback-actions[data-v-ee56945d]{display:flex;gap:12px;padding-left:4px}.cs-feedback-btn[data-v-ee56945d]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border:1px solid rgba(0,0,0,.08);background:#fff;border-radius:4px;color:#9ca3af;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-feedback-btn svg[data-v-ee56945d]{width:8px;height:8px}.cs-feedback-btn[data-v-ee56945d]:hover{border-color:#3b82f6;color:#3b82f6;background:#3b82f60d}.cs-feedback-btn[data-v-ee56945d]:active{transform:scale(.95)}.cs-feedback-btn-active[data-v-ee56945d]{background:#3b82f6;border-color:#3b82f6;color:#fff}.cs-feedback-btn-active[data-v-ee56945d]:hover{background:#2563eb;border-color:#2563eb;color:#fff}@media(max-width:480px){.cs-message-wrapper[data-v-ee56945d]{max-width:80%}.cs-message-content[data-v-ee56945d]{font-size:14px}}.cs-messages-list[data-v-531b4005]{display:flex;flex-direction:column;gap:12px}.cs-input-container[data-v-582889fb]{height:70px;padding:12px 16px;background-color:#f0f5ff;border-top:1px solid rgba(0,0,0,.05);flex-shrink:0}.cs-input-wrapper[data-v-582889fb]{display:flex;align-items:center;gap:12px;height:100%}.cs-input[data-v-582889fb]{flex:1;height:46px;padding:0 16px;background:#fff;border:none;border-radius:23px;font-size:15px;color:#1a1a1a;outline:none;transition:all .2s cubic-bezier(.4,0,.2,1)}.cs-input[data-v-582889fb]::placeholder{color:#9ca3af;font-size:14px}.cs-input[data-v-582889fb]:focus{box-shadow:0 0 0 2px #3b82f633}.cs-input[data-v-582889fb]:disabled{background-color:#f3f4f6;cursor:not-allowed}.cs-send-btn[data-v-582889fb]{width:46px;height:46px;border:none;border-radius:50%;background-color:#e5e7eb;color:#9ca3af;cursor:not-allowed;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0}.cs-send-btn svg[data-v-582889fb]{width:24px;height:24px}.cs-send-btn[data-v-582889fb]:disabled{cursor:not-allowed;transform:none}.cs-send-btn-active[data-v-582889fb]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;cursor:pointer;box-shadow:0 4px 12px #3b82f64d}.cs-send-btn-active[data-v-582889fb]:hover{box-shadow:0 6px 20px #667eea66;transform:scale(1.05)}.cs-send-btn-active[data-v-582889fb]:active{transform:scale(.95)}@media(max-width:480px){.cs-input-container[data-v-582889fb]{padding:10px 12px}.cs-input[data-v-582889fb]{height:42px;font-size:14px}.cs-send-btn[data-v-582889fb]{width:42px;height:42px}.cs-send-btn svg[data-v-582889fb]{width:22px;height:22px}}.cs-quick-questions[data-v-fc7fd5f8]{padding:12px 16px;background:#f0f5ff;border-top:1px solid rgba(0,0,0,.05)}.cs-questions-scroll[data-v-fc7fd5f8]{display:flex;gap:8px;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;-ms-overflow-style:none;scrollbar-width:none}.cs-questions-scroll[data-v-fc7fd5f8]::-webkit-scrollbar{display:none}.cs-question-chip[data-v-fc7fd5f8]{display:inline-flex;align-items:center;gap:4px;padding:8px 12px;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:9999px;white-space:nowrap;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);flex-shrink:0}.cs-question-chip[data-v-fc7fd5f8]:hover{border-color:#3b82f6;color:#3b82f6;box-shadow:0 2px 8px #3b82f633}.cs-question-chip[data-v-fc7fd5f8]:active{transform:scale(.95)}.cs-question-text[data-v-fc7fd5f8]{font-size:12px;color:#1a1a1a}.cs-question-icon[data-v-fc7fd5f8]{width:8px;height:8px;flex-shrink:0;color:#9ca3af}.cs-question-chip:hover .cs-question-icon[data-v-fc7fd5f8]{color:#3b82f6}.cs-chat-window[data-v-e65cdfc5]{position:fixed;bottom:0;width:100%;height:100vh;max-height:100vh;background-color:#f0f5ff;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;z-index:200}.cs-chat-window-left[data-v-e65cdfc5]{left:0;right:auto}.cs-chat-window-right[data-v-e65cdfc5]{left:auto;right:0}.cs-messages-container[data-v-e65cdfc5]{flex:1;overflow-y:auto;overflow-x:hidden;padding:20px 16px;-webkit-overflow-scrolling:touch}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar{width:4px}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-track{background:transparent}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-thumb{background:#0000001a;border-radius:2px}.cs-messages-container[data-v-e65cdfc5]::-webkit-scrollbar-thumb:hover{background:#0003}.cs-messages-list[data-v-e65cdfc5]{display:flex;flex-direction:column;gap:12px}.slide-right-enter-active[data-v-e65cdfc5],.slide-right-leave-active[data-v-e65cdfc5]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.slide-right-enter-from[data-v-e65cdfc5],.slide-right-leave-to[data-v-e65cdfc5]{transform:translate(100%)}.slide-left-enter-active[data-v-e65cdfc5],.slide-left-leave-active[data-v-e65cdfc5]{transition:transform .3s cubic-bezier(.4,0,.2,1)}.slide-left-enter-from[data-v-e65cdfc5],.slide-left-leave-to[data-v-e65cdfc5]{transform:translate(-100%)}@media(min-width:768px){.cs-chat-window[data-v-e65cdfc5]{max-width:420px;bottom:20px;height:calc(100vh - 40px);max-height:800px;border-radius:16px;box-shadow:0 8px 32px #0000001a}.cs-chat-window-left[data-v-e65cdfc5]{left:20px;transform:none}.cs-chat-window-right[data-v-e65cdfc5]{right:20px;left:auto}.slide-left-enter-from[data-v-e65cdfc5],.slide-left-leave-to[data-v-e65cdfc5]{transform:translate(-100%) translateY(0)}.slide-right-enter-from[data-v-e65cdfc5],.slide-right-leave-to[data-v-e65cdfc5]{transform:translate(100%) translateY(0)}}
`,Ue={title:"智能客服",placeholder:"你可以问我任何平台相关的问题",theme:"light",position:"right",welcomeMessage:"Hi，我是智能客服",quickQuestions:[],enableHistory:!0,maxHistoryDays:7,avatar:{assistant:"",user:""}};class T{app=null;container=null;shadowRoot=null;eventListeners=new Map;isOpen=e.ref(!1);config=e.reactive({});messages=e.ref([]);isLoading=e.ref(!1);unreadCount=e.ref(0);constructor(s={}){Object.assign(this.config,D(Ue,s)),this.loadHistory()}mount(s){if(this.app){console.warn("[ChatSDK] SDK already mounted");return}const n=typeof s=="string"?document.querySelector(s):s||document.body;if(!n){console.error("[ChatSDK] Container not found");return}this.container=document.createElement("chat-sdk-root"),this.container.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999999;
    `,n.appendChild(this.container),this.shadowRoot=this.container.attachShadow({mode:"open"}),this.injectGlobalStyles();const a=document.createElement("div");a.id="chat-sdk-mount-point",this.shadowRoot.appendChild(a),this.app=e.createApp(Ke,{sdk:this}),this.app.mount(a),this.emit("mounted")}unmount(){this.app&&(this.app.unmount(),this.app=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.shadowRoot=null,this.emit("unmounted")}injectGlobalStyles(){if(!this.shadowRoot)return;const s=document.createElement("style");s.textContent=`
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      #chat-sdk-mount-point {
        width: 100%;
        height: 100%;
        position: relative;
      }

      /* 恢复点击事件 - 容器设置了 pointer-events: none */
      #chat-sdk-mount-point > * {
        pointer-events: auto;
      }

      /* SVG 全局样式 - 确保在 Shadow DOM 中正确显示 */
      svg {
        display: inline-block;
        vertical-align: middle;
        overflow: hidden;
        /* 防止无尺寸限制时显示过大 */
        width: 1em;
        height: 1em;
      }

      /* 确保内部路径不会溢出 */
      svg * {
        vector-effect: non-scaling-stroke;
      }

      /* 确保图片正确显示 */
      img {
        display: block;
        max-width: 100%;
        height: auto;
      }

      /* 按钮重置 */
      button {
        font: inherit;
        color: inherit;
        background: none;
        border: none;
        cursor: pointer;
        outline: none;
      }

      /* 按钮内的 SVG 不继承字体相关样式 */
      button svg {
        font: normal;
        width: inherit;
        height: inherit;
      }

      /* 输入框重置 */
      input {
        font: inherit;
        color: inherit;
        outline: none;
        border: none;
        background: none;
      }

      /* 伪元素重置 */
      ::before,
      ::after {
        box-sizing: border-box;
      }
    `,this.shadowRoot.appendChild(s),this.injectComponentStyles()}injectComponentStyles(){if(this.shadowRoot&&!P.includes("请在构建时自动注入")){const s=document.createElement("style");s.textContent=P,this.shadowRoot.appendChild(s)}}open(){this.isOpen.value=!0,this.unreadCount.value=0,this.emit("open")}close(){this.isOpen.value=!1,this.emit("close")}toggle(){this.isOpen.value?this.close():this.open()}async sendMessage(s){if(s.trim()){this.addMessage({id:F(),role:"user",content:s.trim(),timestamp:Date.now()}),this.isLoading.value=!0;try{await this.emitAsync("sendMessage",s)}catch(n){console.error("[ChatSDK] Send message error:",n),this.addMessage({id:F(),role:"system",content:"发送消息失败，请稍后重试",timestamp:Date.now()})}finally{this.isLoading.value=!1}}}addMessage(s){this.messages.value.push(s),this.saveHistory(),!this.isOpen.value&&s.role==="assistant"&&this.unreadCount.value++,this.emit("message",s)}appendMessageContent(s,n){const a=this.messages.value.find(o=>o.id===s);a&&(a.content+=n,a.timestamp=Date.now(),this.emit("messageUpdate",a))}finishMessageStream(s){const n=this.messages.value.find(a=>a.id===s);n&&(n.isStreaming=!1,n.timestamp=Date.now(),this.saveHistory(),this.emit("messageComplete",n))}clearMessages(){this.messages.value=[],this.saveHistory(),this.emit("clear")}handleSendMessage(s){return this.sendMessage(s)}handleAskQuestion(s){this.sendMessage(s.text)}handleFeedback(s){const{messageId:n,type:a}=s,o=this.messages.value.find(r=>r.id===n);o&&o.role==="assistant"&&(o.feedback=a||void 0,this.saveHistory(),this.emit("feedback",o))}handleStreamingComplete(s,n){const a=this.messages.value.find(o=>o.id===s);a?(a.content=n,a.isStreaming=!1,a.timestamp=Date.now()):this.addMessage({id:s,role:"assistant",content:n,isStreaming:!1,timestamp:Date.now()}),this.saveHistory()}loadHistory(){if(this.config.enableHistory)try{const s=localStorage.getItem("chat-sdk-history");if(s){const n=JSON.parse(s),a=Date.now(),o=this.config.maxHistoryDays*24*60*60*1e3;this.messages.value=n.filter(r=>a-r.timestamp<o)}}catch(s){console.error("[ChatSDK] Load history error:",s)}}saveHistory(){if(this.config.enableHistory)try{localStorage.setItem("chat-sdk-history",JSON.stringify(this.messages.value))}catch(s){console.error("[ChatSDK] Save history error:",s)}}emit(s,n){const a=this.eventListeners.get(s);a&&a.forEach(o=>o(n))}async emitAsync(s,n){const a=this.eventListeners.get(s);if(a&&a.size>0){const o=Array.from(a).map(r=>Promise.resolve(r(n)));return Promise.all(o)}return Promise.resolve()}on(s,n){this.eventListeners.has(s)||this.eventListeners.set(s,new Set),this.eventListeners.get(s).add(n)}off(s,n){const a=this.eventListeners.get(s);a&&a.delete(n)}updateConfig(s){Object.assign(this.config,D(this.config,s))}}function We(t){return new T(t)}x.ChatSDK=T,x.createChatSDK=We,x.default=T,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
